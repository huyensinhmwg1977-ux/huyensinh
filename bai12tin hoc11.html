<!doctype html>
<html lang="vi">
 <head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tr·∫Øc Nghi·ªám L·ªõp 11 B√†i 12</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-25px); }
    }
    
    @keyframes shake {
      0%, 100% { transform: rotate(0deg); }
      10%, 30%, 50%, 70%, 90% { transform: rotate(-10deg); }
      20%, 40%, 60%, 80% { transform: rotate(10deg); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .bounce-animation {
      animation: bounce 0.8s ease-in-out;
    }
    
    .shake-animation {
      animation: shake 0.6s ease-in-out;
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    .slide-up {
      animation: slideUp 0.6s ease-out;
    }
    
    .pulse-animation {
      animation: pulse 1.5s ease-in-out infinite;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .neumorphic-card {
      background: #ffffff;
      box-shadow: 
        20px 20px 60px #d1d1d1,
        -20px -20px 60px #ffffff;
      border-radius: 30px;
    }
    
    .button-hover {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .button-hover::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .button-hover:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .button-hover:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }
    
    .button-hover:active {
      transform: translateY(0);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    #fireworksCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }
    
    .sad-emoji {
      font-size: 150px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10000;
      text-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      animation: shake 0.6s ease-in-out;
    }
    
    .correct-answer {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      border: 4px solid #0d7d6e;
      transform: scale(1.05);
    }
    
    .wrong-answer {
      background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
      color: white;
      border: 4px solid #c72837;
      transform: scale(0.95);
    }
    
    .answer-button {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .answer-button:hover {
      transform: translateX(10px);
      box-shadow: -5px 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .gold-medal { color: #FFD700; }
    .silver-medal { color: #C0C0C0; }
    .bronze-medal { color: #CD7F32; }
    
    .leaderboard-item {
      transition: all 0.3s ease;
    }
    
    .leaderboard-item:hover {
      transform: translateX(10px);
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }
    
    .loading-spinner {
      animation: spin 1s linear infinite;
    }
    
    #liveLeaderboard::-webkit-scrollbar {
      width: 8px;
    }
    
    #liveLeaderboard::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    #liveLeaderboard::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
    }
    
    #liveLeaderboard::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }
    
    .live-item {
      transition: all 0.3s ease;
    }
    
    .live-item:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .status-doing {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      animation: pulse 2s ease-in-out infinite;
    }
    
    .status-finished {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="w-full min-h-full">
  <canvas id="fireworksCanvas"></canvas>
  <div id="app" class="w-full min-h-full gradient-bg flex items-center justify-center p-6"><!-- M√†n h√¨nh 1: ƒêƒÉng nh·∫≠p -->
   <main id="loginScreen" class="w-full max-w-lg neumorphic-card p-10 fade-in">
    <header class="text-center mb-8">
     <div class="text-7xl mb-4 bounce-animation"><i class="fas fa-graduation-cap"></i>
     </div>
     <h1 id="appTitle" class="text-5xl font-extrabold mb-3 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">Tr·∫Øc Nghi·ªám L·ªõp 11</h1>
     <h2 id="subjectName" class="text-2xl font-bold text-purple-700 mb-2">B√†i 12: H·ªá QTCSDL v√† h·ªá CSDL</h2>
     <p id="welcomeMessage" class="text-gray-600 text-lg"><i class="fas fa-hand-sparkles"></i> Ch√∫c b·∫°n l√†m b√†i t·ªët!</p>
    </header>
    <form id="loginForm" class="space-y-6">
     <div><label for="studentName" class="block text-gray-700 font-bold mb-3 text-lg"> <i class="fas fa-user text-purple-600"></i> H·ªç v√† T√™n </label> <input type="text" id="studentName" required class="w-full px-5 py-4 border-3 border-purple-300 rounded-2xl focus:border-purple-600 focus:outline-none focus:ring-4 focus:ring-purple-200 transition-all text-lg" placeholder="Nh·∫≠p h·ªç v√† t√™n c·ªßa b·∫°n">
     </div>
     <div><label for="studentClass" class="block text-gray-700 font-bold mb-3 text-lg"> <i class="fas fa-school text-purple-600"></i> L·ªõp </label> <input type="text" id="studentClass" required class="w-full px-5 py-4 border-3 border-purple-300 rounded-2xl focus:border-purple-600 focus:outline-none focus:ring-4 focus:ring-purple-200 transition-all text-lg" placeholder="V√≠ d·ª•: 11A1">
     </div><button type="submit" id="startButton" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-5 px-8 rounded-2xl text-2xl button-hover shadow-2xl"> <i class="fas fa-rocket"></i> V√†o Thi </button>
    </form>
   </main><!-- M√†n h√¨nh 2: L√†m b√†i -->
   <main id="quizScreen" class="w-full max-w-7xl hidden">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><!-- Ph·∫ßn l√†m b√†i (2 c·ªôt) -->
     <div class="lg:col-span-2 neumorphic-card p-10 fade-in">
      <header class="flex justify-between items-center mb-8">
       <div class="flex items-center gap-4">
        <div class="text-3xl font-bold text-purple-700"><i class="fas fa-question-circle"></i> C√¢u <span id="currentQuestion">1</span>/10
        </div>
       </div>
       <div class="text-4xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent pulse-animation"><i class="fas fa-trophy"></i> <span id="currentScore">0</span> ƒëi·ªÉm
       </div>
      </header>
      <div class="mb-8">
       <div class="bg-gradient-to-r from-blue-100 via-purple-100 to-pink-100 rounded-3xl p-8 mb-8 shadow-lg">
        <p id="questionText" class="text-2xl font-bold text-gray-800 leading-relaxed"></p>
       </div>
       <div id="answersContainer" class="space-y-4"></div>
      </div>
      <div id="feedbackContainer" class="hidden mt-8">
       <div id="feedbackMessage" class="p-6 rounded-2xl text-center font-bold text-2xl shadow-lg"></div><button id="nextButton" class="w-full mt-6 bg-gradient-to-r from-blue-500 to-blue-700 text-white font-bold py-4 px-8 rounded-2xl text-xl button-hover shadow-xl"> <i class="fas fa-arrow-right"></i> C√¢u ti·∫øp theo </button>
      </div>
     </div><!-- Sidebar: B·∫£ng x·∫øp h·∫°ng realtime (1 c·ªôt) -->
     <div class="lg:col-span-1 neumorphic-card p-6 fade-in">
      <h3 class="text-2xl font-bold text-purple-700 mb-4 flex items-center justify-center"><i class="fas fa-users mr-2"></i> ƒêang Thi</h3>
      <div id="liveLeaderboard" class="space-y-3 max-h-[600px] overflow-y-auto"><!-- Live leaderboard s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
      </div>
     </div>
    </div>
   </main><!-- M√†n h√¨nh 3: K·∫øt qu·∫£ -->
   <main id="resultScreen" class="w-full max-w-5xl hidden">
    <div class="neumorphic-card p-10 fade-in">
     <header class="text-center mb-10">
      <div class="text-8xl mb-6 bounce-animation"><i class="fas fa-trophy text-yellow-400"></i>
      </div>
      <h2 id="resultTitle" class="text-5xl font-extrabold mb-6 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">K·∫øt Qu·∫£ C·ªßa B·∫°n</h2>
      <div class="text-7xl font-extrabold mb-4"><span id="finalScore" class="bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">0</span> <span class="text-4xl text-gray-600">/ 100 ƒëi·ªÉm</span>
      </div>
      <p id="playerInfo" class="text-2xl text-gray-700 font-semibold"></p>
     </header>
     <section class="mb-10">
      <h3 id="leaderboardTitle" class="text-3xl font-bold text-purple-700 mb-6 flex items-center justify-center"><i class="fas fa-crown gold-medal mr-3"></i> B·∫£ng X·∫øp H·∫°ng</h3>
      <div id="leaderboardContainer" class="space-y-3"></div>
     </section>
     <footer class="flex gap-4"><button id="playAgainButton" class="flex-1 bg-gradient-to-r from-green-500 to-green-700 text-white font-bold py-5 px-8 rounded-2xl text-xl button-hover shadow-xl"> <i class="fas fa-redo-alt"></i> L√†m l·∫°i </button>
     </footer>
    </div>
   </main>
  </div>
  <script>
    const defaultConfig = {
      app_title: "Tr·∫Øc Nghi·ªám L·ªõp 11",
      subject_name: "B√†i 12: H·ªá QTCSDL v√† h·ªá CSDL",
      welcome_message: "Ch√∫c b·∫°n l√†m b√†i t·ªët!",
      start_button_text: "üöÄ V√†o Thi",
      correct_message: "üéâ Ch√≠nh x√°c! Xu·∫•t s·∫Øc!",
      wrong_message: "üò¢ Ch∆∞a ƒë√∫ng r·ªìi!",
      result_title: "K·∫øt Qu·∫£ C·ªßa B·∫°n",
      leaderboard_title: "üèÜ B·∫£ng X·∫øp H·∫°ng",
      background_color: "#667eea",
      surface_color: "#ffffff",
      text_color: "#1f2937",
      primary_action_color: "#9333ea",
      secondary_action_color: "#ec4899",
      font_family: "system-ui",
      font_size: 16
    };

    const questions = [
      {
        question: "C√¢u 1: H·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu (H·ªá QTCSDL) l√† g√¨?",
        answers: [
          "A. L√† t·∫≠p h·ª£p c√°c d·ªØ li·ªáu c√≥ li√™n quan v·ªõi nhau ƒë∆∞·ª£c l∆∞u tr·ªØ tr√™n m√°y t√≠nh.",
          "B. L√† ph·∫ßn m·ªÅm cung c·∫•p ph∆∞∆°ng th·ª©c ƒë·ªÉ l∆∞u tr·ªØ, c·∫≠p nh·∫≠t, truy xu·∫•t, b·∫£o m·∫≠t v√† an to√†n d·ªØ li·ªáu c·ªßa CSDL.",
          "C. L√† thi·∫øt b·ªã ph·∫ßn c·ª©ng d√πng ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu l√¢u d√†i.",
          "D. L√† ph·∫ßn m·ªÅm ·ª©ng d·ª•ng gi√∫p ng∆∞·ªùi d√πng cu·ªëi xem tin t·ª©c v√† gi·∫£i tr√≠."
        ],
        correct: 1
      },
      {
        question: "C√¢u 2: M·ªôt H·ªá c∆° s·ªü d·ªØ li·ªáu (H·ªá CSDL) bao g·ªìm ba th√†nh ph·∫ßn ch√≠nh n√†o?",
        answers: [
          "A. Ph·∫ßn c·ª©ng, H·ªá ƒëi·ªÅu h√†nh, Internet.",
          "B. CSDL, H·ªá QTCSDL, C√°c ph·∫ßn m·ªÅm ·ª©ng d·ª•ng CSDL.",
          "C. M√°y ch·ªß, M√°y tr·∫°m, C√°p m·∫°ng.",
          "D. Ng∆∞·ªùi qu·∫£n tr·ªã, Ng∆∞·ªùi d√πng, K·ªπ thu·∫≠t vi√™n."
        ],
        correct: 1
      },
      {
        question: "C√¢u 3: ƒê√¢u l√† t√™n c·ªßa c√°c H·ªá qu·∫£n tr·ªã CSDL ph·ªï bi·∫øn hi·ªán nay?",
        answers: [
          "A. Windows, Linux, macOS, Android.",
          "B. Word, Excel, PowerPoint, Access.",
          "C. Oracle, MySQL, SQL Server, PostgreSQL.",
          "D. Chrome, Firefox, C·ªëc C·ªëc, Edge."
        ],
        correct: 2
      },
      {
        question: "C√¢u 4: Ch·ª©c nƒÉng n√†o sau ƒë√¢y thu·ªôc nh√≥m ch·ª©c nƒÉng 'C·∫≠p nh·∫≠t v√† truy xu·∫•t d·ªØ li·ªáu' c·ªßa h·ªá QTCSDL?",
        answers: [
          "A. Khai b√°o t·∫°o l·∫≠p CSDL m·ªõi.",
          "B. Th√™m, x√≥a, s·ª≠a d·ªØ li·ªáu trong c√°c b·∫£ng.",
          "C. C·∫•p quy·ªÅn truy c·∫≠p cho ng∆∞·ªùi d√πng.",
          "D. Sao l∆∞u d·ª± ph√≤ng d·ªØ li·ªáu."
        ],
        correct: 1
      },
      {
        question: "C√¢u 5: ƒêi·ªÉm kh√°c bi·ªát c∆° b·∫£n nh·∫•t gi·ªØa H·ªá CSDL t·∫≠p trung v√† H·ªá CSDL ph√¢n t√°n l√† g√¨?",
        answers: [
          "A. V·ªã tr√≠ l∆∞u tr·ªØ c·ªßa C∆° s·ªü d·ªØ li·ªáu.",
          "B. S·ªë l∆∞·ª£ng ng∆∞·ªùi s·ª≠ d·ª•ng.",
          "C. Lo·∫°i ph·∫ßn m·ªÅm ·ª©ng d·ª•ng ƒë∆∞·ª£c s·ª≠ d·ª•ng.",
          "D. T·ªëc ƒë·ªô x·ª≠ l√Ω c·ªßa m√°y t√≠nh c√° nh√¢n."
        ],
        correct: 0
      },
      {
        question: "C√¢u 6: Trong h·ªá CSDL ph√¢n t√°n, '·ª©ng d·ª•ng to√†n c·ª•c' l√† g√¨?",
        answers: [
          "A. L√† ·ª©ng d·ª•ng ch·∫°y t·∫°i m·ªôt tr·∫°m v√† ch·ªâ s·ª≠ d·ª•ng d·ªØ li·ªáu t·∫°i tr·∫°m ƒë√≥.",
          "B. L√† ·ª©ng d·ª•ng ch·∫°y t·∫°i m·ªôt tr·∫°m v√† s·ª≠ d·ª•ng d·ªØ li·ªáu c·ªßa √≠t nh·∫•t hai tr·∫°m.",
          "C. L√† ·ª©ng d·ª•ng c√†i ƒë·∫∑t tr√™n m√°y ch·ªß trung t√¢m ƒë·ªÉ qu·∫£n l√Ω to√†n b·ªô m·∫°ng.",
          "D. L√† ·ª©ng d·ª•ng cho ph√©p ng∆∞·ªùi d√πng truy c·∫≠p Internet mi·ªÖn ph√≠."
        ],
        correct: 1
      },
      {
        question: "C√¢u 7: Khi b·∫°n s·ª≠ d·ª•ng ·ª©ng d·ª•ng tra c·ª©u ƒëi·ªÉm thi tr√™n ƒëi·ªán tho·∫°i, b·∫°n nh·∫≠p S·ªë b√°o danh v√† nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£. Trong m√¥ h√¨nh H·ªá CSDL, ·ª©ng d·ª•ng tr√™n ƒëi·ªán tho·∫°i c·ªßa b·∫°n ƒë√≥ng vai tr√≤ l√† g√¨?",
        answers: [
          "A. H·ªá qu·∫£n tr·ªã CSDL (DBMS).",
          "B. C∆° s·ªü d·ªØ li·ªáu (Database).",
          "C. Ph·∫ßn m·ªÅm ·ª©ng d·ª•ng CSDL (Ph·∫ßn m·ªÅm kh√°ch).",
          "D. H·ªá ƒëi·ªÅu h√†nh m√°y ch·ªß."
        ],
        correct: 2
      },
      {
        question: "C√¢u 8: M·ªôt ng√¢n h√†ng c√≥ chi nh√°nh t·∫°i H√† N·ªôi, ƒê√† N·∫µng v√† TP.HCM. D·ªØ li·ªáu kh√°ch h√†ng t·∫°i m·ªói chi nh√°nh ƒë∆∞·ª£c l∆∞u tr·ªØ t·∫°i m√°y ch·ªß c·ªßa chi nh√°nh ƒë√≥, nh∆∞ng gi√°m ƒë·ªëc t·∫°i H√† N·ªôi v·∫´n c√≥ th·ªÉ xem b√°o c√°o t·ªïng h·ª£p t·ª´ t·∫•t c·∫£ chi nh√°nh. ƒê√¢y l√† m√¥ h√¨nh g√¨?",
        answers: [
          "A. H·ªá CSDL t·∫≠p trung.",
          "B. H·ªá CSDL ph√¢n t√°n.",
          "C. H·ªá CSDL c√° nh√¢n.",
          "D. H·ªá x·ª≠ l√Ω t·ªáp tin truy·ªÅn th·ªëng."
        ],
        correct: 1
      },
      {
        question: "C√¢u 9: Gi·∫£ s·ª≠ hai nh√¢n vi√™n c√πng truy c·∫≠p v√†o m·ªôt b·∫£n ghi kh√°ch h√†ng c√πng m·ªôt l√∫c: Nh√¢n vi√™n A ƒëang s·ª≠a ƒë·ªãa ch·ªâ, Nh√¢n vi√™n B ra l·ªánh x√≥a kh√°ch h√†ng ƒë√≥. H·ªá QTCSDL gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ tranh ch·∫•p d·ªØ li·ªáu n√†y b·∫±ng nh√≥m ch·ª©c nƒÉng n√†o?",
        answers: [
          "A. Nh√≥m ch·ª©c nƒÉng ƒë·ªãnh nghƒ©a d·ªØ li·ªáu.",
          "B. Nh√≥m ch·ª©c nƒÉng giao di·ªán l·∫≠p tr√¨nh ·ª©ng d·ª•ng.",
          "C. Nh√≥m ch·ª©c nƒÉng c·∫≠p nh·∫≠t d·ªØ li·ªáu.",
          "D. Nh√≥m ch·ª©c nƒÉng b·∫£o m·∫≠t, an to√†n CSDL (ki·ªÉm so√°t giao d·ªãch)."
        ],
        correct: 3
      },
      {
        question: "C√¢u 10: M√¥ h√¨nh 'M√°y ch·ªß t·ªáp' (File server) trong m·∫°ng LAN, n∆°i to√†n b·ªô t·ªáp CSDL ƒë∆∞·ª£c chuy·ªÉn v·ªÅ m√°y tr·∫°m ƒë·ªÉ x·ª≠ l√Ω m·ªói khi c√≥ y√™u c·∫ßu, ƒë∆∞·ª£c x·∫øp v√†o lo·∫°i n√†o?",
        answers: [
          "A. H·ªá CSDL ph√¢n t√°n.",
          "B. H·ªá CSDL t·∫≠p trung nh∆∞ng x·ª≠ l√Ω ph√¢n t√°n.",
          "C. H·ªá CSDL t·∫≠p trung v√† x·ª≠ l√Ω t·∫≠p trung.",
          "D. H·ªá CSDL ƒë√°m m√¢y."
        ],
        correct: 1
      }
    ];

    let currentPlayer = { name: '', class: '', startTime: null };
    let currentQuestionIndex = 0;
    let score = 0;
    let allRecords = [];
    let isProcessingAnswer = false;
    let activeStudents = new Map(); // L∆∞u tr·ªØ h·ªçc sinh ƒëang thi

    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playCorrectSound() {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
      oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
      oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
      oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.3);
      
      gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
    }

    function playWrongSound() {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
      oscillator.frequency.setValueAtTime(180, audioContext.currentTime + 0.15);
      oscillator.frequency.setValueAtTime(140, audioContext.currentTime + 0.3);
      
      gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
    }

    const canvas = document.getElementById('fireworksCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    class Particle {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.velocity = {
          x: (Math.random() - 0.5) * 10,
          y: (Math.random() - 0.5) * 10
        };
        this.alpha = 1;
        this.decay = Math.random() * 0.02 + 0.015;
        this.gravity = 0.15;
      }

      update() {
        this.velocity.y += this.gravity;
        this.x += this.velocity.x;
        this.y += this.velocity.y;
        this.alpha -= this.decay;
      }

      draw() {
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }
    }

    let particles = [];

    function createFirework(x, y) {
      const colors = ['#ff0844', '#ffb199', '#f2ff49', '#00e5ff', '#b967ff', '#05ffa1', '#fffb96'];
      for (let i = 0; i < 80; i++) {
        const color = colors[Math.floor(Math.random() * colors.length)];
        particles.push(new Particle(x, y, color));
      }
    }

    function animateFireworks() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      particles.forEach((particle, index) => {
        particle.update();
        particle.draw();
        
        if (particle.alpha <= 0) {
          particles.splice(index, 1);
        }
      });
      
      if (particles.length > 0) {
        requestAnimationFrame(animateFireworks);
      }
    }

    function showFireworks() {
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          const x = Math.random() * canvas.width;
          const y = Math.random() * canvas.height * 0.6;
          createFirework(x, y);
          if (particles.length > 0) {
            animateFireworks();
          }
        }, i * 300);
      }
    }

    function showSadEmoji() {
      const emoji = document.createElement('div');
      emoji.className = 'sad-emoji';
      emoji.innerHTML = 'üò¢';
      document.body.appendChild(emoji);
      
      setTimeout(() => {
        emoji.remove();
      }, 1500);
    }

    function showScreen(screenId) {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('quizScreen').classList.add('hidden');
      document.getElementById('resultScreen').classList.add('hidden');
      document.getElementById(screenId).classList.remove('hidden');
    }

    function displayLiveLeaderboard() {
      const liveLeaderboard = document.getElementById('liveLeaderboard');
      if (!liveLeaderboard) return;
      
      // K·∫øt h·ª£p h·ªçc sinh ƒëang thi v√† ƒë√£ ho√†n th√†nh
      const allPlayers = [];
      
      // Th√™m h·ªçc sinh ƒëang thi
      activeStudents.forEach((student, key) => {
        allPlayers.push({
          name: student.name,
          class: student.class,
          score: student.score,
          isActive: true,
          startTime: student.startTime
        });
      });
      
      // Th√™m h·ªçc sinh ƒë√£ ho√†n th√†nh
      allRecords.forEach(record => {
        // Ki·ªÉm tra xem h·ªçc sinh n√†y c√≥ ƒëang thi kh√¥ng
        const isCurrentlyActive = Array.from(activeStudents.values()).some(
          s => s.name === record.name && s.class === record.class
        );
        
        if (!isCurrentlyActive) {
          allPlayers.push({
            name: record.name,
            class: record.class,
            score: record.score,
            isActive: false,
            timestamp: record.timestamp
          });
        }
      });
      
      // S·∫Øp x·∫øp theo ƒëi·ªÉm
      allPlayers.sort((a, b) => b.score - a.score);
      
      liveLeaderboard.innerHTML = '';
      
      if (allPlayers.length === 0) {
        liveLeaderboard.innerHTML = '<p class="text-center text-gray-500 text-sm"><i class="fas fa-hourglass-start"></i> Ch∆∞a c√≥ ai thi</p>';
        return;
      }
      
      allPlayers.slice(0, 20).forEach((player, index) => {
        const item = document.createElement('div');
        item.className = 'live-item bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4 shadow-md';
        
        let rankIcon = '';
        let congratsIcon = '';
        if (index === 0) {
          rankIcon = '<i class="fas fa-trophy gold-medal text-xl"></i>';
          congratsIcon = '<span class="text-lg">üéâüëë</span>';
        } else if (index === 1) {
          rankIcon = '<i class="fas fa-medal silver-medal text-xl"></i>';
          congratsIcon = '<span class="text-lg">‚ú®üåü</span>';
        } else if (index === 2) {
          rankIcon = '<i class="fas fa-award bronze-medal text-xl"></i>';
          congratsIcon = '<span class="text-lg">üéä‚≠ê</span>';
        } else {
          rankIcon = `<span class="text-lg font-bold text-gray-600">${index + 1}</span>`;
        }
        
        const statusBadge = player.isActive 
          ? '<span class="status-badge status-doing"><i class="fas fa-pen"></i> ƒêang thi</span>'
          : '<span class="status-badge status-finished"><i class="fas fa-check"></i> Ho√†n th√†nh</span>';
        
        item.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <div class="w-8 text-center">${rankIcon}</div>
              ${congratsIcon}
            </div>
            ${statusBadge}
          </div>
          <div class="font-bold text-base text-gray-800 mb-1">
            <i class="fas fa-user text-xs"></i> ${player.name}
          </div>
          <div class="flex justify-between items-center">
            <span class="text-xs text-gray-600">
              <i class="fas fa-school text-xs"></i> ${player.class}
            </span>
            <span class="text-xl font-extrabold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
              ${player.score} <span class="text-xs">ƒë</span>
            </span>
          </div>
        `;
        
        liveLeaderboard.appendChild(item);
      });
    }

    function displayQuestion() {
      const question = questions[currentQuestionIndex];
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      
      document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
      document.getElementById('questionText').textContent = question.question;
      document.getElementById('currentScore').textContent = score;
      
      const answersContainer = document.getElementById('answersContainer');
      answersContainer.innerHTML = '';
      
      question.answers.forEach((answer, index) => {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = 'answer-button w-full text-left px-6 py-5 bg-white border-4 border-purple-300 rounded-2xl font-bold text-lg hover:bg-purple-50 transition-all shadow-lg';
        button.textContent = answer;
        button.onclick = () => checkAnswer(index);
        answersContainer.appendChild(button);
      });
      
      document.getElementById('feedbackContainer').classList.add('hidden');
      isProcessingAnswer = false;
      
      // C·∫≠p nh·∫≠t ƒëi·ªÉm hi·ªán t·∫°i c·ªßa ng∆∞·ªùi ch∆°i trong activeStudents
      const playerKey = `${currentPlayer.name}_${currentPlayer.class}`;
      if (activeStudents.has(playerKey)) {
        activeStudents.get(playerKey).score = score;
        displayLiveLeaderboard();
      }
    }

    function checkAnswer(selectedIndex) {
      if (isProcessingAnswer) return;
      isProcessingAnswer = true;
      
      const question = questions[currentQuestionIndex];
      const answersContainer = document.getElementById('answersContainer');
      const buttons = answersContainer.querySelectorAll('button');
      const feedbackContainer = document.getElementById('feedbackContainer');
      const feedbackMessage = document.getElementById('feedbackMessage');
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      
      buttons.forEach(btn => {
        btn.disabled = true;
        btn.style.cursor = 'not-allowed';
      });
      
      if (selectedIndex === question.correct) {
        score += 10;
        document.getElementById('currentScore').textContent = score;
        
        // C·∫≠p nh·∫≠t ƒëi·ªÉm trong activeStudents
        const playerKey = `${currentPlayer.name}_${currentPlayer.class}`;
        if (activeStudents.has(playerKey)) {
          activeStudents.get(playerKey).score = score;
          displayLiveLeaderboard();
        }
        
        buttons[selectedIndex].classList.add('correct-answer', 'bounce-animation');
        
        playCorrectSound();
        showFireworks();
        
        feedbackMessage.innerHTML = `<i class="fas fa-check-circle"></i> ${config.correct_message || defaultConfig.correct_message}`;
        feedbackMessage.className = 'p-6 rounded-2xl text-center font-bold text-2xl shadow-lg bg-gradient-to-r from-green-400 to-green-600 text-white';
      } else {
        buttons[selectedIndex].classList.add('wrong-answer', 'shake-animation');
        buttons[question.correct].classList.add('correct-answer', 'pulse-animation');
        
        playWrongSound();
        showSadEmoji();
        
        feedbackMessage.innerHTML = `
          <div><i class="fas fa-times-circle"></i> ${config.wrong_message || defaultConfig.wrong_message}</div>
          <div class="mt-4 text-lg">
            <i class="fas fa-lightbulb"></i> ƒê√°p √°n ƒë√∫ng: <strong>${question.answers[question.correct]}</strong>
          </div>
        `;
        feedbackMessage.className = 'p-6 rounded-2xl text-center font-bold text-2xl shadow-lg bg-gradient-to-r from-red-400 to-red-600 text-white';
      }
      
      feedbackContainer.classList.remove('hidden');
    }

    async function nextQuestion() {
      currentQuestionIndex++;
      
      if (currentQuestionIndex < questions.length) {
        displayQuestion();
      } else {
        await saveScore();
        showResults();
      }
    }

    async function saveScore() {
      if (!window.dataSdk) return;
      
      if (allRecords.length >= 999) {
        return;
      }
      
      const result = await window.dataSdk.create({
        name: currentPlayer.name,
        class: currentPlayer.class,
        score: score,
        timestamp: new Date().toISOString()
      });
      
      if (!result.isOk) {
        console.error('Kh√¥ng th·ªÉ l∆∞u ƒëi·ªÉm');
      }
      
      // X√≥a h·ªçc sinh kh·ªèi danh s√°ch ƒëang thi
      const playerKey = `${currentPlayer.name}_${currentPlayer.class}`;
      activeStudents.delete(playerKey);
      displayLiveLeaderboard();
    }

    function showResults() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      
      showScreen('resultScreen');
      document.getElementById('finalScore').textContent = score;
      
      // T√≠nh th·ª© h·∫°ng c·ªßa h·ªçc sinh hi·ªán t·∫°i
      const sortedRecords = [...allRecords].sort((a, b) => b.score - a.score);
      let rank = 1;
      for (let i = 0; i < sortedRecords.length; i++) {
        if (sortedRecords[i].name === currentPlayer.name && sortedRecords[i].class === currentPlayer.class) {
          rank = i + 1;
          break;
        }
      }
      
      let rankDisplay = '';
      let rankIcon = '';
      if (rank === 1) {
        rankIcon = 'üèÜüëë';
        rankDisplay = `<span class="text-6xl font-extrabold gold-medal">H·∫°ng ${rank}</span> ${rankIcon}`;
      } else if (rank === 2) {
        rankIcon = 'ü•à‚ú®';
        rankDisplay = `<span class="text-6xl font-extrabold silver-medal">H·∫°ng ${rank}</span> ${rankIcon}`;
      } else if (rank === 3) {
        rankIcon = 'ü•â‚≠ê';
        rankDisplay = `<span class="text-6xl font-extrabold bronze-medal">H·∫°ng ${rank}</span> ${rankIcon}`;
      } else {
        rankDisplay = `<span class="text-5xl font-extrabold text-purple-600">H·∫°ng ${rank}</span>`;
      }
      
      document.getElementById('playerInfo').innerHTML = `
        <div class="mb-4">${rankDisplay}</div>
        <div><i class="fas fa-user-graduate"></i> ${currentPlayer.name} - ${currentPlayer.class}</div>
      `;
      
      displayLeaderboard();
    }

    function displayLeaderboard() {
      const leaderboardContainer = document.getElementById('leaderboardContainer');
      leaderboardContainer.innerHTML = '';
      
      if (allRecords.length === 0) {
        leaderboardContainer.innerHTML = '<p class="text-center text-gray-500 text-lg"><i class="fas fa-inbox"></i> Ch∆∞a c√≥ d·ªØ li·ªáu x·∫øp h·∫°ng</p>';
        return;
      }
      
      const sortedRecords = [...allRecords].sort((a, b) => b.score - a.score);
      
      sortedRecords.slice(0, 10).forEach((record, index) => {
        const item = document.createElement('div');
        item.className = 'leaderboard-item flex items-center justify-between p-5 bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl slide-up shadow-md';
        item.style.animationDelay = `${index * 0.1}s`;
        
        let rankIcon = '';
        if (index === 0) rankIcon = '<i class="fas fa-trophy gold-medal text-3xl"></i>';
        else if (index === 1) rankIcon = '<i class="fas fa-medal silver-medal text-3xl"></i>';
        else if (index === 2) rankIcon = '<i class="fas fa-award bronze-medal text-3xl"></i>';
        else rankIcon = `<span class="text-2xl font-bold text-gray-600">${index + 1}</span>`;
        
        item.innerHTML = `
          <div class="flex items-center gap-5">
            <div class="w-12 text-center">${rankIcon}</div>
            <div>
              <div class="font-bold text-xl text-gray-800">
                <i class="fas fa-user"></i> ${record.name}
              </div>
              <div class="text-sm text-gray-600">
                <i class="fas fa-school"></i> ${record.class}
              </div>
            </div>
          </div>
          <div class="text-3xl font-extrabold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
            ${record.score} <span class="text-lg">ƒëi·ªÉm</span>
          </div>
        `;
        
        leaderboardContainer.appendChild(item);
      });
    }

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      
      const appElement = document.getElementById('app');
      if (appElement) {
        appElement.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color} 0%, ${config.primary_action_color || defaultConfig.primary_action_color} 100%)`;
      }
      
      const cards = document.querySelectorAll('.neumorphic-card');
      cards.forEach(card => {
        card.style.backgroundColor = config.surface_color || defaultConfig.surface_color;
      });
      
      const textElements = document.querySelectorAll('p, label, input, div');
      textElements.forEach(el => {
        if (!el.className.includes('bg-gradient-to-r') && !el.className.includes('text-white')) {
          el.style.color = config.text_color || defaultConfig.text_color;
        }
      });
      
      document.getElementById('appTitle').textContent = config.app_title || defaultConfig.app_title;
      document.getElementById('subjectName').textContent = config.subject_name || defaultConfig.subject_name;
      document.getElementById('welcomeMessage').innerHTML = `<i class="fas fa-hand-sparkles"></i> ${config.welcome_message || defaultConfig.welcome_message}`;
      document.getElementById('startButton').innerHTML = `<i class="fas fa-rocket"></i> ${config.start_button_text || defaultConfig.start_button_text}`;
      document.getElementById('resultTitle').textContent = config.result_title || defaultConfig.result_title;
      document.getElementById('leaderboardTitle').innerHTML = `<i class="fas fa-crown gold-medal mr-3"></i> ${config.leaderboard_title || defaultConfig.leaderboard_title}`;
      
      document.getElementById('appTitle').style.fontSize = `${baseSize * 2.5}px`;
      document.getElementById('subjectName').style.fontSize = `${baseSize * 1.5}px`;
      document.getElementById('welcomeMessage').style.fontSize = `${baseSize * 1.125}px`;
      document.getElementById('resultTitle').style.fontSize = `${baseSize * 2.5}px`;
      
      const questionTextElement = document.getElementById('questionText');
      if (questionTextElement) {
        questionTextElement.style.fontSize = `${baseSize * 1.5}px`;
      }
      
      const buttons = document.querySelectorAll('button');
      buttons.forEach(btn => {
        if (btn.id === 'startButton' || btn.id === 'playAgainButton') {
          btn.style.background = `linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color} 0%, ${config.secondary_action_color || defaultConfig.secondary_action_color} 100%)`;
        }
        btn.style.fontSize = `${baseSize}px`;
      });
    }

    const dataHandler = {
      onDataChanged(data) {
        allRecords = data;
        
        // C·∫≠p nh·∫≠t b·∫£ng x·∫øp h·∫°ng realtime n·∫øu ƒëang ·ªü m√†n h√¨nh l√†m b√†i
        if (!document.getElementById('quizScreen').classList.contains('hidden')) {
          displayLiveLeaderboard();
        }
        
        if (!document.getElementById('resultScreen').classList.contains('hidden')) {
          displayLeaderboard();
        }
      }
    };

    document.addEventListener('DOMContentLoaded', async () => {
      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error('Kh√¥ng th·ªÉ kh·ªüi t·∫°o Data SDK');
        }
      }
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ['app_title', config.app_title || defaultConfig.app_title],
            ['subject_name', config.subject_name || defaultConfig.subject_name],
            ['welcome_message', config.welcome_message || defaultConfig.welcome_message],
            ['start_button_text', config.start_button_text || defaultConfig.start_button_text],
            ['correct_message', config.correct_message || defaultConfig.correct_message],
            ['wrong_message', config.wrong_message || defaultConfig.wrong_message],
            ['result_title', config.result_title || defaultConfig.result_title],
            ['leaderboard_title', config.leaderboard_title || defaultConfig.leaderboard_title]
          ])
        });
      }
      
      document.getElementById('loginForm').addEventListener('submit', (e) => {
        e.preventDefault();
        currentPlayer.name = document.getElementById('studentName').value;
        currentPlayer.class = document.getElementById('studentClass').value;
        currentPlayer.startTime = new Date().toISOString();
        
        // Th√™m h·ªçc sinh v√†o danh s√°ch ƒëang thi
        const playerKey = `${currentPlayer.name}_${currentPlayer.class}`;
        activeStudents.set(playerKey, {
          name: currentPlayer.name,
          class: currentPlayer.class,
          score: 0,
          startTime: currentPlayer.startTime
        });
        
        showScreen('quizScreen');
        displayQuestion();
        displayLiveLeaderboard();
      });
      
      document.getElementById('nextButton').addEventListener('click', nextQuestion);
      
      document.getElementById('playAgainButton').addEventListener('click', () => {
        currentQuestionIndex = 0;
        score = 0;
        showScreen('loginScreen');
        document.getElementById('loginForm').reset();
      });
      
      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      });
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c36149bf53cdd8b',t:'MTc2OTMyNjM4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

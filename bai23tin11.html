<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ai L√† Tri·ªáu Ph√∫ - Kh√¥ng L·∫∑p C√¢u Tho·∫°i</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-color: #1a237e;
            --secondary-color: #ffca28;
            --text-color: #ffffff;
            --danger-color: #ff0000;
            --rank-1: #FFD700;
            --rank-2: #C0C0C0;
            --rank-3: #CD7F32;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(circle, #0d47a1 0%, #000000 100%);
            color: var(--text-color);
            margin: 0; padding: 0; overflow: hidden;
            height: 100vh; width: 100vw; user-select: none; display: flex; 
        }

        /* --- STYLE CHO C√ÅC PH·∫¶N M·ªöI --- */
        .feedback-msg {
            margin-top: 15px;
            font-size: 1.4em; 
            font-weight: 900; 
            font-style: italic;
            min-height: 1.5em;
            color: #ff0000; /* M√ÄU ƒê·ªé */
            text-shadow: 1px 1px 0 #fff; 
            animation: popIn 0.3s ease-out;
        }
        
        @keyframes popIn { from {transform: scale(0.5); opacity: 0;} to {transform: scale(1); opacity: 1;} }

        .exit-btn { 
            position: absolute; top: 20px; right: 20px; 
            background: #d32f2f; color: #fff; padding: 8px 15px; 
            border-radius: 20px; cursor: pointer; font-size: 0.9em; z-index: 100; 
            font-weight: bold; border: 1px solid #b71c1c;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .exit-btn:hover { background: #ff0000; }

        /* --- LAYOUT CHUNG --- */
        #main-area { flex: 1; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; height: 100vh; overflow-y: auto; }
        
        #sidebar-leaderboard { width: 350px; background: rgba(0, 0, 0, 0.7); border-left: 3px solid var(--secondary-color); padding: 20px; box-sizing: border-box; display: none; flex-direction: column; height: 100vh; backdrop-filter: blur(10px); z-index: 50; }
        .lb-header { flex-shrink: 0; margin-bottom: 10px; }
        .lb-title { color: var(--secondary-color); text-align: center; font-size: 1.6em; margin-bottom: 5px; text-shadow: 0 0 5px #ff6f00; font-weight: bold; border-bottom: 2px solid #fff; padding-bottom: 10px; }
        #sidebar-list { flex-grow: 1; overflow-y: auto; padding-right: 5px; }
        #sidebar-list::-webkit-scrollbar { width: 8px; }
        #sidebar-list::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); border-radius: 4px; }
        #sidebar-list::-webkit-scrollbar-thumb { background: var(--secondary-color); border-radius: 4px; }
        
        .lb-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255, 255, 255, 0.1); margin-bottom: 6px; padding: 8px 12px; border-radius: 8px; transition: transform 0.2s; font-size: 0.95em; }
        .lb-item:hover { background: rgba(255, 255, 255, 0.25); }
        .lb-rank { font-weight: bold; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 10px; color: #000; font-size: 0.9em; flex-shrink: 0; }
        .rank-1 .lb-rank { background: var(--rank-1); box-shadow: 0 0 10px var(--rank-1); }
        .rank-2 .lb-rank { background: var(--rank-2); }
        .rank-3 .lb-rank { background: var(--rank-3); }
        .rank-other .lb-rank { background: #fff; color: #333; font-size: 0.8em; border: 1px solid #ccc; }
        .lb-name { flex: 1; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; }
        .lb-score { font-weight: bold; color: #00ff00; margin-left: 10px; min-width: 30px; text-align: right; }
        .reset-data-btn { margin-top: 10px; background: #444; color: #ccc; border: 1px solid #666; padding: 8px; width: 100%; cursor: pointer; font-size: 0.8em; border-radius: 5px; }
        .reset-data-btn:hover { background: #d32f2f; color: white; border-color: #d32f2f; }

        #q-title { color: #ff0000; font-weight: 900; font-size: 1.8em; text-transform: uppercase; margin: 0; text-shadow: 2px 2px 0px rgba(0,0,0,0.1); letter-spacing: 2px; }
        .question-text { font-size: 1.5em; margin-top: 20px; margin-bottom: 25px; font-weight: bold; color: #0000ff; line-height: 1.4; }

        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #000000 0%, #1a237e 100%); z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s ease; }
        .login-box { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); padding: 40px; border-radius: 20px; border: 2px solid rgba(255, 255, 255, 0.2); text-align: center; box-shadow: 0 0 50px rgba(0, 229, 255, 0.3); width: 90%; max-width: 400px; }
        .login-title { font-size: 2.5em; color: var(--secondary-color); margin-bottom: 30px; text-shadow: 0 0 10px #ff6f00; font-weight: bold; }
        .login-input { width: 100%; padding: 15px; margin-bottom: 20px; border: none; border-radius: 30px; font-size: 1.1em; text-align: center; outline: none; box-sizing: border-box; }
        .start-btn { padding: 15px 50px; font-size: 1.2em; background: linear-gradient(45deg, #ff6f00, #ffca28); border: none; border-radius: 30px; color: #fff; font-weight: bold; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .start-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 202, 40, 0.6); }

        #game-container { display: none; flex-direction: column; align-items: center; width: 100%; padding-top: 20px; opacity: 0; transition: opacity 1s ease; }
        h1.game-title { text-align: center; text-shadow: 0 0 10px #00e5ff; color: var(--secondary-color); margin-top: 10px; margin-bottom: 10px; }
        .status-bar { display: flex; gap: 20px; margin-bottom: 20px; font-size: 1.2em; background: rgba(255, 255, 255, 0.1); padding: 10px 20px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.2); }
        .highlight { color: var(--secondary-color); font-weight: bold; }

        .wheel-container { position: relative; width: 350px; height: 350px; margin: 0 auto; }
        .pointer { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 45px solid #ff1744; z-index: 10; filter: drop-shadow(0 4px 2px rgba(0,0,0,0.8)); }
        .wheel { width: 100%; height: 100%; border-radius: 50%; border: 8px solid #fff; position: relative; overflow: hidden; transition: transform 1s cubic-bezier(0.25, 0.1, 0.25, 1); box-shadow: 0 0 30px rgba(0, 229, 255, 0.5); cursor: pointer; }
        .wheel-inner { width: 100%; height: 100%; background: conic-gradient( #FF5252 0deg 36deg, #FF4081 36deg 72deg, #E040FB 72deg 108deg, #7C4DFF 108deg 144deg, #536DFE 144deg 180deg, #448AFF 180deg 216deg, #40C4FF 216deg 252deg, #18FFFF 252deg 288deg, #69F0AE 288deg 324deg, #EEFF41 324deg 360deg ); border-radius: 50%; }
        .number { position: absolute; top: 50%; left: 50%; transform-origin: 0 0; font-weight: bold; font-size: 20px; color: #fff; text-shadow: 2px 2px 2px rgba(0,0,0,0.8); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; pointer-events: none; }
        .number.used { color: #333; text-decoration: line-through; opacity: 0.5; }
        .number.used::after { content: "‚úî"; position: absolute; color: #000; font-size: 30px; opacity: 0.8; }
        .center-circle { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70px; height: 70px; background: radial-gradient(#fff, #eee); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary-color); box-shadow: 0 0 15px rgba(0,0,0,0.5); z-index: 5; cursor: pointer; border: 4px solid var(--primary-color); text-align: center; font-size: 0.9em; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: linear-gradient(to bottom, #fff, #f0f0f0); color: #333; padding: 30px; border-radius: 15px; width: 90%; max-width: 650px; text-align: center; box-shadow: 0 0 30px rgba(255, 202, 40, 0.4); border: 4px solid var(--secondary-color); animation: popup 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .option-btn { padding: 15px; border: 2px solid #bbb; border-radius: 50px; background: white; cursor: pointer; font-size: 1.1em; transition: all 0.2s; position: relative; z-index: 10; }
        .option-btn:hover { background: #e3f2fd; border-color: var(--primary-color); }
        .option-btn.correct { background: #4caf50; color: white; border-color: #2e7d32; }
        .option-btn.wrong { background: #f44336; color: white; border-color: #c62828; }
        .close-btn { margin-top: 25px; padding: 12px 35px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; display: none; }
        
        .end-game-title { color: #ff0000; text-transform: uppercase; font-weight: 900; margin-bottom: 10px; text-shadow: 1px 1px 0 rgba(0,0,0,0.1); }
        .rank-highlight { color: #ff0000; font-weight: 900; font-size: 1.8em; }
        .final-lb-container { margin-top: 20px; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 10px; }
        .final-lb-table { width: 100%; border-collapse: collapse; }
        .final-lb-table th { background: var(--primary-color); color: white; padding: 8px; position: sticky; top: 0; }
        .final-lb-table td { padding: 8px; border-bottom: 1px solid #eee; }
        .current-player-row { background-color: #fff9c4; font-weight: bold; border: 2px solid var(--secondary-color) !important; }
        .modal-exit-btn { display: inline-block; background-color: #d32f2f; color: white; padding: 12px 35px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; margin-right: 10px; }
        .modal-exit-btn:hover { background-color: #ff0000; }

        @media (max-width: 800px) {
            body { flex-direction: column; overflow-y: auto; }
            #sidebar-leaderboard { display: none !important; }
            #main-area { width: 100%; height: auto; }
        }
    </style>
</head>
<body>
    <div id="login-screen">
        <div class="login-box">
            <div class="login-title">AI L√Ä TRI·ªÜU PH√ö<br><span style="font-size:0.5em; color:#fff">GIMP Edition</span></div>
            <input type="text" id="player-name-input" class="login-input" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n...">
            <button class="start-btn" onclick="startGame()">V√ÄO CH∆†I</button>
            <p style="margin-top:20px; font-size:0.9em; color:#ccc">Nh·∫≠p t√™n ƒë·ªÉ l∆∞u ƒëi·ªÉm v√†o B·∫£ng X·∫øp H·∫°ng</p>
        </div>
    </div>

    <div id="main-area">
        <div id="game-container">
            <button class="exit-btn" onclick="exitGame()">Tho√°t Game</button>
            <h1 class="game-title">V√íNG QUAY TRI·ªÜU PH√ö</h1>
            <div class="status-bar">
                <div>Ng∆∞·ªùi ch∆°i: <span id="player-display" class="highlight">...</span></div>
                <div>ƒêi·ªÉm: <span id="score" class="highlight">0</span></div>
                <div>V√≤ng: <span id="turns" class="highlight">0</span>/10</div>
            </div>

            <div class="wheel-container">
                <div class="pointer"></div>
                <div class="wheel" id="wheel" onclick="spinWheel()">
                    <div class="wheel-inner"></div>
                    <div id="numbers-container"></div>
                </div>
                <div class="center-circle" onclick="spinWheel()" id="spin-btn">QUAY</div>
            </div>
            
            <p id="instruction" style="margin-top:20px; color: #bbb">B·∫•m v√†o n√∫t QUAY ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
        </div>
    </div>

    <div id="sidebar-leaderboard">
        <div class="lb-header"><div class="lb-title">üèÜ B·∫¢NG X·∫æP H·∫†NG</div></div>
        <div id="sidebar-list"></div>
        <button class="reset-data-btn" onclick="resetLeaderboard()">üóëÔ∏è X√≥a d·ªØ li·ªáu x·∫øp h·∫°ng</button>
    </div>

    <div class="modal" id="questionModal">
        <div class="modal-content">
            <h3 id="q-title">C√¢u h·ªèi s·ªë X</h3>
            <div style="height: 3px; background: #ddd; margin: 10px 0 20px 0;"></div>
            <p class="question-text" id="q-text">N·ªôi dung c√¢u h·ªèi...</p>
            <div class="options-grid" id="options-area"></div>
            <div id="feedback-area" class="feedback-msg"></div>
            <button class="close-btn" id="nextBtn" onclick="closeModal()">Ti·∫øp t·ª•c</button>
        </div>
    </div>

    <div class="modal" id="endGameModal">
        <div class="modal-content" id="end-game-modal">
            <h2 class="end-game-title">K·∫æT QU·∫¢ CHUNG CU·ªòC</h2>
            <p class="msg">Ng∆∞·ªùi ch∆°i: <b id="end-player-name" style="font-size:1.2em; color:var(--primary-color)"></b></p>
            <div style="font-size: 3em; color: var(--secondary-color); margin: 5px 0;" id="final-score">0</div>
            <div style="background: #f1f1f1; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                B·∫°n x·∫øp h·∫°ng: <span id="final-rank" class="rank-highlight">#?</span>
            </div>
            <div class="final-lb-container">
                <table class="final-lb-table">
                    <thead><tr><th>H·∫°ng</th><th>T√™n</th><th>ƒêi·ªÉm</th></tr></thead>
                    <tbody id="final-lb-body"></tbody>
                </table>
            </div>
            <div style="margin-top: 15px;">
                <button class="modal-exit-btn" onclick="exitGame()">Tho√°t</button>
                <button class="close-btn" style="display: inline-block;" onclick="location.reload()">Ch∆°i l∆∞·ª£t m·ªõi</button>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'trieuPhu_scores_v5';

        // --- H·ªÜ TH·ªêNG X·ª¨ L√ù TIN NH·∫ÆN KH√îNG L·∫∂P ---
        // 1. Danh s√°ch g·ªëc (D√πng ƒë·ªÉ n·∫°p l·∫°i khi h·∫øt)
        const originalCompliments = [
            "Qu√° xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i!",
            "ƒê·ªânh c·ªßa ch√≥p! Kh√¥ng th·ªÉ tin ƒë∆∞·ª£c!",
            "Tuy·ªát v·ªùi! Chu·∫©n kh√¥ng c·∫ßn ch·ªânh!",
            "Hay qu√°! 10 ƒëi·ªÉm v·ªÅ ch·ªó!",
            "Ki·∫øn th·ª©c uy√™n th√¢m! B√°i ph·ª•c!",
            "Ch√≠nh x√°c tuy·ªát ƒë·ªëi! Qu√° gh√™ g·ªõm!",
            "Si√™u tr√≠ tu·ªá! Qu√° gi·ªèi!",
            "M·ªôt c√¢u tr·∫£ l·ªùi ho√†n h·∫£o!"
        ];

        const originalEncouragements = [
            "ƒê·ª´ng bu·ªìn! Th·∫•t b·∫°i l√† m·∫π th√†nh c√¥ng!",
            "C·ªë l√™n! L·∫ßn sau s·∫Ω ƒë√∫ng th√¥i!",
            "Ti·∫øc qu√°! Ch·ªâ sai m·ªôt ch√∫t x√≠u.",
            "B√¨nh tƒ©nh nh√©! C∆° h·ªôi v·∫´n c√≤n!",
            "Kh√¥ng sao! Sai m·ªôt ly ƒëi m·ªôt d·∫∑m th√¥i!",
            "H√£y tin v√†o b·∫£n th√¢n! B·∫°n l√†m ƒë∆∞·ª£c m√†!",
            "V·∫°n s·ª± kh·ªüi ƒë·∫ßu nan, ƒë·ª´ng n·∫£n ch√≠!",
            "Thua keo n√†y ta b√†y keo kh√°c!"
        ];

        // 2. Danh s√°ch l√†m vi·ªác (S·∫Ω b·ªã tr·ª´ d·∫ßn)
        let availableCompliments = [...originalCompliments];
        let availableEncouragements = [...originalEncouragements];

        // 3. H√†m l·∫•y tin nh·∫Øn kh√¥ng l·∫∑p
        function getUniqueMessage(type) {
            let arr, orig;
            
            if (type === 'correct') {
                arr = availableCompliments;
                orig = originalCompliments;
            } else {
                arr = availableEncouragements;
                orig = originalEncouragements;
            }

            // N·∫øu h·∫øt c√¢u, n·∫°p l·∫°i t·ª´ ƒë·∫ßu
            if (arr.length === 0) {
                arr = [...orig];
                if (type === 'correct') availableCompliments = arr;
                else availableEncouragements = arr;
            }

            // Ch·ªçn ng·∫´u nhi√™n 1 index
            const index = Math.floor(Math.random() * arr.length);
            const message = arr[index];

            // X√≥a c√¢u ƒë√≥ kh·ªèi danh s√°ch l√†m vi·ªác (ƒë·ªÉ kh√¥ng l·∫∑p l·∫°i ngay)
            arr.splice(index, 1);

            return message;
        }
        // ------------------------------------------

        function saveScore(name, score) {
            let scores = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
            scores.push({ name: name, score: score, timestamp: Date.now() });
            scores.sort((a, b) => b.score - a.score);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(scores));
            return scores;
        }
        function getScores() { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
        function resetLeaderboard() { if(confirm("X√≥a to√†n b·ªô b·∫£ng x·∫øp h·∫°ng?")) { localStorage.removeItem(STORAGE_KEY); renderSidebarLeaderboard(); } }
        function renderSidebarLeaderboard() {
            const list = document.getElementById('sidebar-list'); list.innerHTML = '';
            const scores = getScores();
            if (scores.length === 0) { list.innerHTML = '<div style="text-align:center; color:#ccc; padding:20px;">Ch∆∞a c√≥ d·ªØ li·ªáu</div>'; return; }
            scores.forEach((item, index) => {
                const rank = index + 1;
                let rankClass = rank === 1 ? 'rank-1' : (rank === 2 ? 'rank-2' : (rank === 3 ? 'rank-3' : 'rank-other'));
                const div = document.createElement('div'); div.className = `lb-item ${rankClass}`;
                div.innerHTML = `<div class="lb-rank">${rank}</div><div class="lb-name" title="${item.name}">${item.name}</div><div class="lb-score">${item.score}</div>`;
                list.appendChild(div);
            });
        }

        // √Çm thanh
        let audioCtx;
        function initAudio() { if (!audioCtx) { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } if (audioCtx.state === 'suspended') audioCtx.resume(); }
        function playTickSound() { if (!audioCtx) return; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'triangle'; osc.frequency.setValueAtTime(150, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1); gain.gain.setValueAtTime(0.3, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.1); }
        function playCorrectSound() { if (!audioCtx) return; const t = audioCtx.currentTime; createNote(600, t, 0.1, 'sine'); createNote(800, t+0.1, 0.1, 'sine'); createNote(1200, t+0.2, 0.4, 'sine'); }
        function playWrongSound() { if (!audioCtx) return; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(40, audioCtx.currentTime+0.5); gain.gain.setValueAtTime(0.3, audioCtx.currentTime); gain.gain.linearRampToValueAtTime(0.001, audioCtx.currentTime+0.5); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime+0.5); }
        function createNote(freq, t, dur, type) { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = type; osc.frequency.value = freq; gain.gain.setValueAtTime(0.3, t); gain.gain.exponentialRampToValueAtTime(0.001, t+dur); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(t); osc.stop(t+dur); }

        const questions = [
            { id: 1, text: "·∫¢nh bitmap ƒë∆∞·ª£c t·∫°o th√†nh t·ª´ c√°c th√†nh ph·∫ßn nh·ªè g·ªçi l√† g√¨?", options: ["A. Vector", "B. Pixel", "C. Line", "D. Shape"], correct: 1 },
            { id: 2, text: "ƒê∆°n v·ªã n√†o d√πng ƒë·ªÉ ƒëo ƒë·ªô ph√¢n gi·∫£i c·ªßa h√¨nh ·∫£nh?", options: ["A. Hz", "B. Byte", "C. dpi", "D. bps"], correct: 2 },
            { id: 3, text: "ƒê·∫∑c ƒëi·ªÉm n·ªïi b·∫≠t c·ªßa ph·∫ßn m·ªÅm GIMP l√† g√¨?", options: ["A. R·∫•t ƒë·∫Øt ti·ªÅn", "B. Ch·ªâ ch·∫°y tr√™n Windows", "C. M√£ ngu·ªìn m·ªü, mi·ªÖn ph√≠", "D. Kh√¥ng th·ªÉ ch·ªânh s·ª≠a ·∫£nh"], correct: 2 },
            { id: 4, text: "ƒê·ªÉ chuy·ªÉn giao di·ªán GIMP v·ªÅ ch·∫ø ƒë·ªô m·ªôt c·ª≠a s·ªï, ch·ªçn l·ªánh n√†o?", options: ["A. File > Single-window Mode", "B. Edit > Single-window Mode", "C. View > Single-window Mode", "D. Windows > Single-window Mode"], correct: 3 },
            { id: 5, text: "T·ªáp tin d·ª± √°n m·∫∑c ƒë·ªãnh c·ªßa GIMP c√≥ ƒëu√¥i l√† g√¨?", options: ["A. .jpg", "B. .png", "C. .xcf", "D. .bmp"], correct: 2 },
            { id: 6, text: "TƒÉng dpi nh∆∞ng gi·ªØ nguy√™n k√≠ch th∆∞·ªõc in (inch), ƒëi·ªÅu g√¨ x·∫£y ra?", options: ["A. ·∫¢nh m·ªù ƒëi", "B. ·∫¢nh n√©t h∆°n (nhi·ªÅu pixel h∆°n)", "C. Dung l∆∞·ª£ng gi·∫£m", "D. ·∫¢nh th√†nh ƒëen tr·∫Øng"], correct: 1 },
            { id: 7, text: "C√¥ng c·ª• n√†o d√πng ƒë·ªÉ lo·∫°i b·ªè ph·∫ßn th·ª´a ·ªü vi·ªÅn ·∫£nh?", options: ["A. Rotate", "B. Scale", "C. Crop", "D. Zoom"], correct: 2 },
            { id: 8, text: "Khi Scale Image, n·∫øu bi·ªÉu t∆∞·ª£ng x√≠ch n·ªëi li·ªÅn nghƒ©a l√† g√¨?", options: ["A. Gi·ªØ nguy√™n t·ªâ l·ªá khung h√¨nh", "B. Ch·ªâ ƒë·ªïi ƒë∆∞·ª£c chi·ªÅu r·ªông", "C. ƒê·ªïi chi·ªÅu cao t√πy √Ω", "D. ·∫¢nh b·ªã m√©o"], correct: 0 },
            { id: 9, text: "·∫¢nh b·ªã nghi√™ng, d√πng c√¥ng c·ª• n√†o ƒë·ªÉ ch·ªânh th·∫≥ng?", options: ["A. Crop Tool", "B. Rotate Tool", "C. Scale Tool", "D. Zoom Tool"], correct: 1 },
            { id: 10, text: "Ph√°t bi·ªÉu n√†o l√† SAI v·ªÅ ·∫£nh s·ªë?", options: ["A. Ph√≥ng to bitmap b·ªã v·ª° h·∫°t", "B. Nhi·ªÅu pixel th√¨ file c√†ng n·∫∑ng", "C. M√†n h√¨nh c·∫ßn 300dpi, in ·∫•n ch·ªâ c·∫ßn 72dpi", "D. ƒê·ªô ph√¢n gi·∫£i l√† s·ªë ƒëi·ªÉm ·∫£nh/inch"], correct: 2 }
        ];

        let playerName="Ng∆∞·ªùi ch∆°i", currentScore=0, turnCount=0, isSpinning=false, currentRotation=0, availableQuestions=[0,1,2,3,4,5,6,7,8,9], segmentAngle=360/10, spinInterval;
        
        const loginScreen = document.getElementById('login-screen'); const gameContainer = document.getElementById('game-container'); const sidebar = document.getElementById('sidebar-leaderboard'); const wheel = document.getElementById('wheel'); const numbersContainer = document.getElementById('numbers-container'); const questionModal = document.getElementById('questionModal'); const endGameModal = document.getElementById('endGameModal'); const feedbackArea = document.getElementById('feedback-area');

        function startGame() {
            initAudio();
            const inputName = document.getElementById('player-name-input').value;
            if(inputName.trim() !== "") playerName = inputName;
            document.getElementById('player-display').textContent = playerName;
            renderSidebarLeaderboard();
            loginScreen.style.opacity = 0;
            setTimeout(() => { loginScreen.style.display='none'; gameContainer.style.display='flex'; sidebar.style.display='flex'; gameContainer.style.opacity=1; }, 500);
        }

        function exitGame() { if(confirm("Tho√°t game?")) location.reload(); }

        function initWheel() {
            for(let i=0; i<10; i++){
                const d = document.createElement('div'); d.className='number'; d.id=`num-${i}`; d.textContent=i+1;
                const r = (i*segmentAngle)+(segmentAngle/2); d.style.transform=`rotate(${r}deg) translate(0, -135px) rotate(-${r}deg)`;
                numbersContainer.appendChild(d);
            }
        }
        initWheel();

        function spinWheel() {
            if(isSpinning || availableQuestions.length===0) { if(availableQuestions.length===0) showEndGame(); return; }
            isSpinning=true; document.getElementById('spin-btn').style.pointerEvents='none';
            let c=0; spinInterval=setInterval(()=>{ playTickSound(); c++; if(c>20) clearInterval(spinInterval); }, 50);
            const randIdx = Math.floor(Math.random()*availableQuestions.length); const sIdx = availableQuestions[randIdx];
            const tAngle = (sIdx*segmentAngle)+(segmentAngle/2); const dist = (5*360) + (360-tAngle + Math.floor(Math.random()*20)-10) - (currentRotation%360);
            currentRotation += (dist < 0 ? dist+360 : dist); wheel.style.transform = `rotate(${currentRotation}deg)`;
            setTimeout(()=>{ clearInterval(spinInterval); isSpinning=false; showQuestion(sIdx); }, 1000);
        }

        function showQuestion(i) {
            const q = questions[i];
            document.getElementById('q-title').textContent = `C√ÇU H·ªéI S·ªê ${i+1}`; document.getElementById('q-text').textContent = q.text;
            feedbackArea.textContent = "";
            const area = document.getElementById('options-area'); area.innerHTML=''; document.getElementById('nextBtn').style.display='none';
            q.options.forEach((opt, idx) => {
                const b = document.createElement('button'); b.className='option-btn'; b.textContent=opt;
                b.onclick = () => checkAnswer(b, idx, q.correct, i); area.appendChild(b);
            });
            questionModal.style.display='flex';
        }

        function checkAnswer(btn, sIdx, cIdx, qIdx) {
            const all = document.querySelectorAll('.option-btn'); all.forEach(b=>b.onclick=null);
            
            // X·ª≠ l√Ω logic l·ªùi nh·∫Øn kh√¥ng l·∫∑p
            let feedback = "";
            
            if(sIdx===cIdx) {
                btn.classList.add('correct'); currentScore+=10; document.getElementById('score').textContent=currentScore;
                playCorrectSound(); confetti({particleCount:50, spread:60});
                
                // L·∫•y l·ªùi ch√∫c kh√¥ng l·∫∑p
                const msg = getUniqueMessage('correct');
                feedback = `+10 ƒêi·ªÉm! ${msg}`;
                
                feedbackArea.className="feedback-msg";
            } else {
                btn.classList.add('wrong'); all[cIdx].classList.add('correct'); playWrongSound();
                
                // L·∫•y l·ªùi ƒë·ªông vi√™n kh√¥ng l·∫∑p
                const msg = getUniqueMessage('wrong');
                feedback = msg;
                
                feedbackArea.className="feedback-msg";
            }
            
            feedbackArea.textContent = feedback;
            
            availableQuestions = availableQuestions.filter(x=>x!==qIdx); document.getElementById(`num-${qIdx}`).classList.add('used');
            turnCount++; document.getElementById('turns').textContent=turnCount;
            const nb = document.getElementById('nextBtn'); nb.textContent = turnCount>=10 ? "Xem k·∫øt qu·∫£" : "Ti·∫øp t·ª•c";
            nb.onclick = turnCount>=10 ? showEndGame : closeModal; nb.style.display='inline-block';
        }

        function closeModal() { questionModal.style.display='none'; document.getElementById('spin-btn').style.pointerEvents='auto'; }

        function showEndGame() {
            questionModal.style.display='none';
            const allScores = saveScore(playerName, currentScore);
            const myRank = allScores.findIndex(s=>s.score===currentScore && s.name===playerName)+1;
            endGameModal.style.display='flex';
            document.getElementById('final-score').textContent = currentScore;
            document.getElementById('end-player-name').textContent = playerName;
            document.getElementById('final-rank').textContent = "#"+myRank;
            renderSidebarLeaderboard();
            const tb = document.getElementById('final-lb-body'); tb.innerHTML='';
            allScores.forEach((item, idx) => {
                const tr = document.createElement('tr'); if(item.name===playerName && item.score===currentScore && idx===(myRank-1)) tr.className='current-player-row';
                tr.innerHTML=`<td>${idx+1}</td><td>${item.name}</td><td>${item.score}</td>`; tb.appendChild(tr);
            });
            if(currentScore>=80) { confetti({particleCount:100, spread:70}); playCorrectSound(); }
        }

        document.getElementById("player-name-input").addEventListener("keypress", function(e){ if(e.key==="Enter") startGame(); });
    </script>
</body>
</html>

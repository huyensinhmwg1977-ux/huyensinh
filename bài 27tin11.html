<!DOCTYPE html>
<html lang="vi" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kh√°m Ph√° GIMP - B√†i 27 Tin h·ªçc 11</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 0;
            touch-action: manipulation;
            user-select: none;
        }

        /* --- 1. HI·ªÜU ·ª®NG ANIMATION --- */
        @keyframes float { 0%, 100% { transform: translate(-50%, -50%) translateY(0px); } 50% { transform: translate(-50%, -50%) translateY(-12px); } }
        @keyframes wave { 0%, 100% { transform: translateX(0) translateY(0); } 25% { transform: translateX(5px) translateY(-5px); } 75% { transform: translateX(-5px) translateY(5px); } }
        @keyframes glow { 0%, 100% { filter: drop-shadow(0 0 10px rgba(255, 223, 0, 0.6)); } 50% { filter: drop-shadow(0 0 25px rgba(255, 223, 0, 1)); } }
        
        @keyframes logoFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        @keyframes hop { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        .animal-hop { animation: hop 1s ease-in-out infinite; }
        
        .star-particle {
            position: absolute; width: 6px; height: 6px; background: #fbbf24; border-radius: 50%; pointer-events: none; opacity: 0; box-shadow: 0 0 6px #facc15;
        }
        @keyframes starFloat {
            0% { transform: translate(0, 0) scale(0.3) rotate(0deg); opacity: 0; }
            20% { opacity: 0.9; scale: 1; }
            80% { opacity: 0.9; scale: 0.8; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0.1) rotate(180deg); opacity: 0; }
        }

        @keyframes flyFlock { 0% { transform: translateX(-20vw) translateY(var(--startY)) scale(var(--scale)); opacity: 0; } 5% { opacity: 1; } 95% { opacity: 1; } 100% { transform: translateX(120vw) translateY(var(--endY)) scale(var(--scale)); opacity: 0; } }
        @keyframes wingFlapRealistic { 0% { transform: scaleY(1); } 50% { transform: scaleY(-0.6); } 100% { transform: scaleY(1); } }
        .bird-flock { position: absolute; pointer-events: none; z-index: 4; }
        .bird { position: absolute; }

        @keyframes sailBoat1 { 0% { transform: translateX(-100px) translateY(0px) rotate(0deg); } 25% { transform: translateX(300px) translateY(-8px) rotate(-2deg); } 50% { transform: translateX(700px) translateY(0px) rotate(0deg); } 75% { transform: translateX(1100px) translateY(-8px) rotate(2deg); } 100% { transform: translateX(1500px) translateY(0px) rotate(0deg); } }
        @keyframes sailBoat2 { 0% { transform: translateX(1500px) scaleX(-1) translateY(0px) rotate(0deg); } 25% { transform: translateX(1100px) scaleX(-1) translateY(-10px) rotate(2deg); } 50% { transform: translateX(700px) scaleX(-1) translateY(0px) rotate(0deg); } 75% { transform: translateX(300px) scaleX(-1) translateY(-10px) rotate(-2deg); } 100% { transform: translateX(-100px) scaleX(-1) translateY(0px) rotate(0deg); } }
        .boat { position: absolute; pointer-events: none; z-index: 5; }
        @media (max-width: 640px) { .boat { transform: scale(0.6); } }
        .boat1 { animation: sailBoat1 45s ease-in-out infinite; top: 10%; }
        .boat2 { animation: sailBoat2 50s ease-in-out infinite; top: 25%; }

        /* --- TR·∫†NG TH√ÅI ƒê·∫¢O (ƒê√£ ch·ªânh k√≠ch th∆∞·ªõc) --- */
        .island-container {
            position: absolute; transform: translate(-50%, -50%); z-index: 20; cursor: pointer; transition: all 0.5s ease;
            /* Desktop: TƒÉng 1.15 l·∫ßn (140px * 1.15 = ~160px) */
            width: 160px; height: 160px;
        }
        @media (max-width: 640px) { 
            .island-container { 
                /* Mobile: TƒÉng 1.5 l·∫ßn so v·ªõi b·∫£n nh·ªè (75px * 1.5 = ~110px) */
                width: 110px; height: 110px; 
            } 
        }
        
        .island-svg { width: 100%; height: 100%; transition: all 0.5s ease; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2)); }
        .island-container:hover .island-svg { transform: scale(1.1) translateY(-5px); filter: drop-shadow(0 10px 25px rgba(0, 0, 0, 0.4)); }
        .island-locked { pointer-events: none; }
        .island-locked .island-svg { filter: grayscale(100%) brightness(0.4) contrast(1.2); }
        .island-active { pointer-events: auto; }
        .island-active .island-svg { filter: grayscale(0%) brightness(1.05); animation: float 3.5s ease-in-out infinite, glow 2.5s ease-in-out infinite alternate; }
        .island-correct { pointer-events: auto; }
        .island-correct .island-svg { filter: grayscale(0%) brightness(1.2) contrast(1.1) saturate(1.2); }
        .island-wrong .island-svg { filter: grayscale(80%) brightness(0.4); }

        .bg-ocean { background: linear-gradient(to bottom, #1e3a8a, #3b82f6); }
        .wave-bg { animation: wave 8s ease-in-out infinite; }
        
        /* --- MODAL CSS --- */
        .quiz-modal {
            background: white; border: 4px solid #1d4ed8; box-shadow: 0 0 0 6px #ef4444; display: flex; flex-direction: column; max-height: 85vh; width: 95%; max-width: 700px;
        }
        .quiz-content-scroll { 
            overflow-y: auto; flex-grow: 1; padding: 1rem; 
            padding-top: 3rem; /* ƒê·∫©y n·ªôi dung xu·ªëng ƒë·ªÉ kh√¥ng b·ªã badge che */
            scrollbar-width: thin; scrollbar-color: #cbd5e1 transparent; 
        }
        .quiz-content-scroll::-webkit-scrollbar { width: 6px; }
        .quiz-content-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
        .quiz-badge { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); z-index: 60; }

        /* --- LEADERBOARD CSS --- */
        .leaderboard-modal {
            background: rgba(255, 255, 255, 0.95); border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); max-width: 500px; width: 95%; border: 4px solid #facc15; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; z-index: 100;
        }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.5); } 100% { opacity: 1; transform: scale(1); } }
        .rank-row:nth-child(1) td { color: #d97706; font-weight: bold; font-size: 1.1em; background-color: #fef3c7; }
        .rank-row:nth-child(2) td { color: #64748b; font-weight: bold; background-color: #f1f5f9; }
        .rank-row:nth-child(3) td { color: #b45309; font-weight: bold; background-color: #fff7ed; }
        .rank-row.current-user td { background-color: #dbeafe; border: 2px solid #3b82f6; color: #1e3a8a; }

        .btn-pulse { animation: pulseBtn 1.5s infinite; }
        @keyframes pulseBtn { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(37, 99, 235, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); } }

        /* Logo HS Style */
        .logo-hs-container { position: absolute; bottom: 8px; right: 8px; z-index: 40; display: flex; align-items: center; gap: 6px; pointer-events: none; animation: logoFloat 3s ease-in-out infinite; }
        .logo-hs-badge { width: 40px; height: 40px; background: linear-gradient(135deg, #ef4444, #b91c1c); border: 2px solid #facc15; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); color: white; font-weight: 900; font-size: 20px; text-shadow: 1px 1px 0 #000; }
        .logo-hs-text { font-weight: bold; color: rgba(255,255,255,0.8); font-size: 10px; text-transform: uppercase; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }

        .sparkle { animation: sparkle 2s ease-in-out infinite; }
    </style>
</head>
<body class="h-full bg-ocean">

    <div id="loginScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90 transition-opacity duration-500 p-4">
        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-2xl max-w-md w-full text-center border-4 border-blue-600">
            <h1 class="text-3xl md:text-4xl font-bold text-red-600 mb-4">KH√ÅM PH√Å C√ÅC ƒê·∫¢O</h1>
            <p class="text-gray-600 mb-6 text-sm md:text-base">Nh·∫≠p t√™n c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu kh√°m ph√° 10 h√≤n ƒë·∫£o th·∫ßn ti√™n!</p>
            <input type="text" id="studentNameInput" placeholder="T√™n h·ªçc sinh..." class="w-full p-3 border-2 border-blue-300 rounded-lg mb-6 text-lg focus:outline-none focus:border-blue-600">
            <button onclick="startGame()" class="w-full bg-red-600 text-white font-bold py-3 px-6 rounded-lg text-xl hover:bg-red-700 transition transform hover:scale-105 shadow-lg">B·∫ÆT ƒê·∫¶U</button>
        </div>
    </div>

    <div id="app" class="w-full h-full relative hidden opacity-0 transition-opacity duration-1000">
        
        <svg class="absolute inset-0 w-full h-full pointer-events-none" preserveAspectRatio="xMidYMid slice">
            <defs>
                <pattern id="waves" x="0" y="0" width="200" height="40" patternUnits="userSpaceOnUse">
                    <path d="M0,20 Q50,10 100,20 T200,20" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2" class="wave-bg" />
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#waves)" />
        </svg>

        <div class="absolute top-0 left-0 w-full z-50 p-1 md:p-4 flex justify-between items-start pointer-events-none">
            <div class="bg-white bg-opacity-95 p-1.5 md:p-3 rounded-lg border border-blue-600 shadow-md pointer-events-auto transition-all hover:scale-105 max-w-[40%]">
                <p class="text-blue-900 font-bold text-[10px] md:text-lg truncate">HS: <span id="displayStudentName" class="text-red-600">...</span></p>
                <p class="text-blue-900 font-bold text-[10px] md:text-lg">ƒêi·ªÉm: <span id="scoreDisplay" class="text-red-600 text-xs md:text-2xl">0</span></p>
                <div id="endGameControls" class="hidden mt-1 pt-1 border-t border-gray-300 flex flex-col space-y-1">
                     <button onclick="showLeaderboard()" class="w-full bg-yellow-500 text-white font-bold py-1 px-1 rounded hover:bg-yellow-600 transition shadow animate-bounce text-[10px] md:text-base">üèÜ X·∫æP H·∫†NG</button>
                    <div class="flex space-x-1">
                        <button onclick="location.reload()" class="flex-1 bg-gray-500 text-white text-[10px] md:text-sm font-bold py-0.5 rounded hover:bg-gray-600 transition">Tho√°t</button>
                        <button onclick="restartGame()" class="flex-1 bg-green-600 text-white text-[10px] md:text-sm font-bold py-0.5 rounded hover:bg-green-700 transition">L·∫°i</button>
                    </div>
                </div>
            </div>
            <div class="bg-white bg-opacity-95 p-1.5 md:p-3 rounded-lg border border-red-600 shadow-md text-center pointer-events-auto max-w-[40%]">
                <h1 class="text-[10px] md:text-xl font-bold text-blue-800 uppercase">Ch·ªçn ƒë·∫£oO</h1>
                <p class="text-[10px] md:text-base font-bold text-gray-700"><span id="currentIslandNum">1</span> / 10</p>
            </div>
        </div>

        <div class="logo-hs-container">
            <div class="logo-hs-text">Design by</div>
            <div class="logo-hs-badge">HS</div>
        </div>

        <div class="absolute inset-0 z-10 pointer-events-none overflow-hidden">
            <div class="boat boat1"><svg width="80" height="60" viewBox="0 0 80 60"><polygon points="20,45 60,45 55,50 25,50" fill="#8b4513" opacity="0.8" /> <rect x="38" y="15" width="4" height="30" fill="#654321" /> <polygon points="40,15 40,35 15,35" fill="#ef4444" opacity="0.9" /> <polygon points="42,18 42,30 60,30" fill="#dc2626" opacity="0.9" /></svg></div>
            <div class="boat boat2"><svg width="70" height="55" viewBox="0 0 70 55"><polygon points="15,40 55,40 50,45 20,45" fill="#8b4513" opacity="0.8" /> <rect x="33" y="12" width="4" height="28" fill="#654321" /> <polygon points="35,12 35,32 12,32" fill="#3b82f6" opacity="0.9" /> <polygon points="37,15 37,28 52,28" fill="#2563eb" opacity="0.9" /></svg></div>
        </div>

        <div id="birdsContainer" class="absolute inset-0 z-30 pointer-events-none overflow-hidden"></div>

        <div id="islandsMap" class="relative w-full h-full z-20 max-w-[1400px] mx-auto"></div>

        <div id="quizModal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden items-center justify-center p-4 transition-opacity duration-300">
            <div class="quiz-modal rounded-2xl relative border-4 border-blue-700 bg-white transform transition-all scale-100">
                <div class="quiz-badge bg-blue-700 text-white w-12 h-12 md:w-16 md:h-16 rounded-full font-bold border-2 border-white shadow-lg flex items-center justify-center text-xl md:text-2xl">
                    <span id="quizNumber"></span>
                </div>
                
                <div class="quiz-content-scroll">
                    <p id="quizQuestion" class="text-base md:text-2xl mb-3 md:mb-4 text-center text-red-600 font-bold leading-relaxed"></p>
                    <div id="quizAnswers" class="space-y-2 md:space-y-3 pb-2 md:pb-4"></div>
                    <div id="quizFeedback" class="mt-2 md:mt-4 p-2 md:p-3 rounded text-center font-bold text-sm md:text-lg hidden"></div>
                    <div id="nextQuestionContainer" class="mt-3 md:mt-4 pb-2 md:pb-4 hidden flex justify-center">
                        <button onclick="nextQuestionAction()" class="btn-pulse bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold py-2 px-6 md:py-3 md:px-8 rounded-full text-sm md:text-lg shadow-lg border-2 border-white hover:from-blue-600 hover:to-indigo-700 transition transform">
                            C√ÇU TI·∫æP THEO
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="leaderboardModalWrapper" class="fixed inset-0 bg-black bg-opacity-70 z-[70] hidden items-center justify-center p-4 backdrop-blur-sm">
            <div class="leaderboard-modal flex flex-col p-4 md:p-6 relative">
                <button onclick="closeLeaderboard()" class="absolute top-2 right-2 text-gray-500 hover:text-red-500 text-2xl font-bold">&times;</button>
                <h3 class="text-xl md:text-3xl font-extrabold text-center text-yellow-600 mb-4 uppercase tracking-wider drop-shadow-sm">B·∫£ng X·∫øp H·∫°ng</h3>
                <div class="overflow-y-auto max-h-[60vh] rounded-lg border border-gray-200 bg-white">
                    <table class="w-full text-left border-collapse text-sm md:text-base">
                        <thead class="bg-gray-100 sticky top-0">
                            <tr>
                                <th class="p-2 md:p-3 font-bold text-gray-700 border-b">H·∫°ng</th>
                                <th class="p-2 md:p-3 font-bold text-gray-700 border-b">T√™n HS</th>
                                <th class="p-2 md:p-3 font-bold text-gray-700 border-b text-right">ƒêi·ªÉm</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody" class="text-gray-800"></tbody>
                    </table>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="closeLeaderboard()" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-700 transition shadow-lg text-sm md:text-base">ƒê√≥ng</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- 1. D·ªÆ LI·ªÜU C√ÇU H·ªéI ---
        const questions = [
            { question: "C√¢u 1: Trong ph·∫ßn m·ªÅm GIMP, c√¥ng c·ª• n√†o sau ƒë√¢y ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ v·∫Ω c√°c n√©t m·ªÅm, m∆∞·ª£t (anti-aliasing)?", answers: ["A. Pencil (B√∫t ch√¨)", "B. Paintbrush (C·ªç v·∫Ω)", "C. Eraser (T·∫©y)", "D. Clone Tool (Sao ch√©p)"], correct: 1 },
            { question: "C√¢u 2: ƒê·ªÉ ch·ªçn v√πng ngu·ªìn (l·∫•y m·∫´u) khi s·ª≠ d·ª•ng c√¥ng c·ª• Clone, em c·∫ßn nh·∫•n gi·ªØ ph√≠m n√†o k·∫øt h·ª£p v·ªõi nh√°y chu·ªôt?", answers: ["A. Shift", "B. Alt", "C. Ctrl", "D. Tab"], correct: 2 },
            { question: "C√¢u 3: Tham s·ªë n√†o trong h·ªôp tho·∫°i t√πy ch·ªânh c√¥ng c·ª• (Tool Options) d√πng ƒë·ªÉ ƒëi·ªÅu ch·ªânh ƒë·ªô m·ªù ƒë·ª•c (ƒë·ªô trong su·ªët) c·ªßa n√©t v·∫Ω?", answers: ["A. Size", "B. Hardness", "C. Force", "D. Opacity"], correct: 3 },
            { question: "C√¢u 4: C√¥ng c·ª• n√†o sau ƒë√¢y c√≥ ch·ª©c nƒÉng ch√≠nh l√† sao ch√©p c√°c m·∫´u t·ª´ m·ªôt v·ªã tr√≠ c·ªßa ·∫£nh ƒë·∫øn m·ªôt v·ªã tr√≠ kh√°c?", answers: ["A. Text Tool", "B. Healing Tool", "C. Clone Tool", "D. Bucket Fill Tool"], correct: 2 },
            { question: "C√¢u 5: C√¥ng c·ª• Healing (bi·ªÉu t∆∞·ª£ng h√¨nh bƒÉng c√° nh√¢n) th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng cho m·ª•c ƒë√≠ch g√¨?", answers: ["A. V·∫Ω c√°c ƒë∆∞·ªùng th·∫≥ng", "B. X√≥a c√°c chi ti·∫øt th·ª´a l·ªõn", "C. X√≥a c√°c v·∫øt l·ªëm ƒë·ªëm, v·∫øt s·∫πo, m·ª•n nh·ªè tr√™n ·∫£nh", "D. Vi·∫øt ch·ªØ l√™n ·∫£nh"], correct: 2 },
            { question: "C√¢u 6: S·ª± kh√°c bi·ªát c∆° b·∫£n nh·∫•t v·ªÅ n√©t v·∫Ω gi·ªØa c√¥ng c·ª• Pencil (B√∫t ch√¨) v√† Paintbrush (C·ªç v·∫Ω) l√† g√¨?", answers: ["A. Pencil t·∫°o ra n√©t v·∫Ω c√≥ bi√™n c·ª©ng (rƒÉng c∆∞a), c√≤n Paintbrush t·∫°o ra n√©t v·∫Ω c√≥ bi√™n m·ªÅm", "B. Pencil ch·ªâ v·∫Ω ƒë∆∞·ª£c m√†u ƒëen tr·∫Øng, c√≤n Paintbrush v·∫Ω ƒë∆∞·ª£c nhi·ªÅu m√†u", "C. Pencil kh√¥ng th·ªÉ thay ƒë·ªïi k√≠ch th∆∞·ªõc, c√≤n Paintbrush th√¨ c√≥ th·ªÉ", "D. Pencil d√πng ƒë·ªÉ x√≥a, c√≤n Paintbrush d√πng ƒë·ªÉ t√¥ m√†u"], correct: 0 },
            { question: "C√¢u 7: Khi s·ª≠ d·ª•ng c√¥ng c·ª• Eraser (T·∫©y) tr√™n m·ªôt l·ªõp ·∫£nh ch∆∞a c√≥ k√™nh Alpha, v√πng b·ªã t·∫©y s·∫Ω chuy·ªÉn th√†nh m√†u g√¨?", answers: ["A. M√†u trong su·ªët (caro)", "B. M√†u tr·∫Øng", "C. M√†u ti·ªÅn c·∫£nh (Foreground)", "D. M√†u h·∫≠u c·∫£nh (Background)"], correct: 3 },
            { question: "C√¢u 8: T·∫°i sao khi ch·ªânh s·ª≠a da m·∫∑t (x√≥a m·ª•n, v·∫øt th√¢m), c√¥ng c·ª• Healing th∆∞·ªùng mang l·∫°i k·∫øt qu·∫£ t·ª± nhi√™n h∆°n c√¥ng c·ª• Clone?", answers: ["A. V√¨ Healing t·ª± ƒë·ªông l√†m m·ªù to√†n b·ªô b·ª©c ·∫£nh", "B. V√¨ Healing sao ch√©p y nguy√™n c√°c ƒëi·ªÉm ·∫£nh t·ª´ v√πng m·∫´u", "C. V√¨ Healing h√≤a tr·ªôn c√°c ƒëi·ªÉm ·∫£nh m·∫´u v·ªõi v√πng ƒë√≠ch ƒë·ªÉ ph√π h·ª£p s·∫Øc ƒë·ªô", "D. V√¨ Healing cho ph√©p v·∫Ω th√™m c√°c chi ti·∫øt m·ªõi"], correct: 2 },
            { question: "C√¢u 9: Khi thi·∫øt l·∫≠p thu·ªôc t√≠nh cho c·ªç v·∫Ω, n·∫øu b·∫°n mu·ªën n√©t v·∫Ω c√≥ bi√™n r·∫•t s·∫Øc n√©t, kh√¥ng b·ªã nh√≤e m·ªù ·ªü vi·ªÅn, b·∫°n c·∫ßn ƒëi·ªÅu ch·ªânh tham s·ªë Hardness nh∆∞ th·∫ø n√†o?", answers: ["A. Gi·∫£m Hardness xu·ªëng m·ª©c th·∫•p nh·∫•t (0)", "B. TƒÉng Hardness l√™n m·ª©c cao nh·∫•t (100)", "C. Ch·ªânh Hardness v·ªÅ m·ª©c trung b√¨nh (50)", "D. Ch·ªânh tham s·ªë Opacity thay v√¨ Hardness"], correct: 1 },
            { question: "C√¢u 10: C√¥ng c·ª• Perspective Clone kh√°c bi·ªát so v·ªõi c√¥ng c·ª• Clone th√¥ng th∆∞·ªùng ·ªü ƒëi·ªÉm n√†o?", answers: ["A. N√≥ ch·ªâ sao ch√©p ƒë∆∞·ª£c m√†u ƒëen tr·∫Øng", "B. N√≥ cho ph√©p sao ch√©p ƒë·ªëi t∆∞·ª£ng v√† t·ª± ƒë·ªông bi·∫øn ƒë·ªïi theo ph·ªëi c·∫£nh (3D)", "C. N√≥ ch·ªâ ho·∫°t ƒë·ªông tr√™n c√°c l·ªõp vƒÉn b·∫£n", "D. N√≥ kh√¥ng c·∫ßn ph·∫£i ch·ªçn v√πng ngu·ªìn (l·∫•y m·∫´u) tr∆∞·ªõc khi v·∫Ω"], correct: 1 }
        ];

        // --- 2. H·ªÜ TH·ªêNG √ÇM THANH ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playCorrectSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.type = 'sine'; osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.1); 
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.connect(gainNode); gainNode.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            setTimeout(() => {
                const osc2 = audioCtx.createOscillator(); const gain2 = audioCtx.createGain();
                osc2.type = 'triangle'; osc2.frequency.setValueAtTime(1318.51, audioCtx.currentTime); 
                gain2.gain.setValueAtTime(0.3, audioCtx.currentTime); gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
                osc2.connect(gain2); gain2.connect(audioCtx.destination); osc2.start(); osc2.stop(audioCtx.currentTime + 0.6);
            }, 100);
        }

        function playWrongSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(); const gainNode = audioCtx.createGain();
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3); 
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.connect(gainNode); gainNode.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.4);
        }

        const praises = ["Tuy·ªát v·ªùi!", "Ch√≠nh x√°c!", "Hoan h√¥!", "Xu·∫•t s·∫Øc!", "ƒê√∫ng r·ªìi!", "Hay qu√°!", "ƒê·ªânh c·ªßa ch√≥p!"];
        const encouragements = ["C·ªë l√™n!", "Ti·∫øc qu√°!", "Th·ª≠ l·∫°i n√†o!", "Sai r·ªìi!"];

        // --- 3. H√åNH ·∫¢NH ƒê·∫¢O ---
        const rabbitSVG = `<g class="animal-hop"><ellipse cx="0" cy="0" rx="4" ry="3" fill="white"/><circle cx="0" cy="-3" r="2.5" fill="white"/><path d="M-1.5,-4 L-2,-7 M1.5,-4 L2,-7" stroke="white" stroke-width="1" stroke-linecap="round"/></g>`;
        const sheepSVG = `<g><ellipse cx="0" cy="0" rx="5" ry="4" fill="#fdf4ff"/><circle cx="-4" cy="-2" r="3" fill="#fdf4ff"/><path d="M-3,3 L-3,6 M3,3 L3,6" stroke="#4b5563" stroke-width="1.5"/></g>`; 
        const personSVG = (color="#ef4444") => `<g class="person-static"><circle cx="0" cy="-6" r="2" fill="#fecaca"/><path d="M-2,0 L2,0 L3,6 L-3,6 Z" fill="${color}"/><line x1="-1.5" y1="6" x2="-1.5" y2="10" stroke="#334155" stroke-width="1"/><line x1="1.5" y1="6" x2="1.5" y2="10" stroke="#334155" stroke-width="1"/></g>`;
        const treeSVG = (x, y, scale=1) => `<g transform="translate(${x}, ${y}) scale(${scale})"><path d="M0,0 L-6,18 L6,18 Z" fill="#15803d"/><path d="M0,-6 L-5,8 L5,8 Z" fill="#16a34a"/><rect x="-1" y="18" width="2" height="4" fill="#78350f"/></g>`;
        const bushSVG = (x, y, r=4, color="#22c55e") => `<circle cx="${x}" cy="${y}" r="${r}" fill="${color}"/>`;
        const flowerSVG = (x, y, color="#fde047") => `<circle cx="${x}" cy="${y}" r="2" fill="${color}"/>`;

        const C_WHITE = "#f8fafc"; const C_RED = "#ff2a2a"; const C_BLUE = "#3b82f6"; const C_YELLOW = "#ffdd00"; const C_GREEN = "#22c55e"; const C_PURPLE = "#d946ef"; const C_ORANGE = "#f97316"; const C_DARK_BLUE_TOWER = "#1e3a8a";

        const islandDesigns = [
            `<svg class="island-svg" width="140" height="140" viewBox="0 0 140 140"><defs><radialGradient id="island1"><stop offset="0%" style="stop-color:#4ade80"/><stop offset="100%" style="stop-color:#16a34a"/></radialGradient><filter id="glow1"><feGaussianBlur stdDeviation="2" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><ellipse cx="70" cy="85" rx="50" ry="28" fill="url(#island1)"/><path d="M50,45 Q48,55 50,75" stroke="#15803d" stroke-width="3.5" fill="none"/><circle cx="50" cy="45" r="13" fill="#ff4081" filter="url(#glow1)"/><path d="M70,38 Q68,53 70,75" stroke="#15803d" stroke-width="4" fill="none"/><circle cx="70" cy="38" r="15" fill="${C_YELLOW}" filter="url(#glow1)"/><path d="M90,45 Q88,55 90,75" stroke="#15803d" stroke-width="3.5" fill="none"/><circle cx="90" cy="45" r="13" fill="#8b5cf6" filter="url(#glow1)"/><path d="M58,55 Q56,63 58,75" stroke="#15803d" stroke-width="3" fill="none"/><circle cx="58" cy="55" r="11" fill="${C_RED}" filter="url(#glow1)"/><path d="M82,55 Q80,63 82,75" stroke="#15803d" stroke-width="3" fill="none"/><circle cx="82" cy="55" r="11" fill="${C_BLUE}" filter="url(#glow1)"/>${bushSVG(35, 80, 5, C_GREEN)} ${bushSVG(105, 80, 5, C_GREEN)} ${bushSVG(70, 95, 4, "#15803d")}${flowerSVG(38, 85, C_YELLOW)} ${flowerSVG(102, 85, C_RED)} ${flowerSVG(65, 90, C_PURPLE)} ${flowerSVG(75, 90, C_BLUE)}<g transform="translate(45, 90)">${rabbitSVG}</g><g transform="translate(85, 92)" style="animation-delay:0.5s">${rabbitSVG}</g><g transform="translate(25, 85)">${rabbitSVG}</g><g transform="translate(60, 95)">${personSVG(C_YELLOW)}</g> <g transform="translate(80, 95)">${personSVG(C_BLUE)}</g><text x="70" y="108" text-anchor="middle" font-size="28" font-weight="bold" fill="#fef3c7" stroke="#000" stroke-width="2.5">1</text></svg>`,
            `<svg class="island-svg" width="140" height="140" viewBox="0 0 140 140"><defs><radialGradient id="island2"><stop offset="0%" style="stop-color:#4ade80"/><stop offset="100%" style="stop-color:#16a34a"/></radialGradient><linearGradient id="castle2"><stop offset="0%" style="stop-color:#c026d3"/><stop offset="100%" style="stop-color:#9333ea"/></linearGradient></defs><ellipse cx="70" cy="92" rx="52" ry="30" fill="url(#island2)"/><rect x="45" y="50" width="50" height="42" fill="url(#castle2)"/><polygon points="45,50 70,30 95,50" fill="#a855f7"/><rect x="53" y="65" width="14" height="27" fill="${C_YELLOW}"/><rect x="66" y="35" width="8" height="15" fill="${C_RED}"/><polygon points="66,35 70,26 74,35" fill="#ff6b6b"/>${treeSVG(30, 80, 0.8)} ${treeSVG(110, 82, 0.9)} ${treeSVG(95, 85, 0.7)} ${treeSVG(40, 90, 0.6)} ${treeSVG(20, 85, 0.7)} ${treeSVG(120, 80, 0.7)}${bushSVG(35, 95, 3, C_YELLOW)} ${bushSVG(105, 95, 3, C_PURPLE)}<g transform="translate(75, 90)">${rabbitSVG}</g> <g transform="translate(35, 90)">${rabbitSVG}</g><g transform="translate(60, 90)">${personSVG(C_RED)}</g> <g transform="translate(85, 90)">${personSVG(C_PURPLE)}</g><text x="70" y="118" text-anchor="middle" font-size="28" font-weight="bold" fill="#fff" stroke="#000" stroke-width="3">2</text></svg>`,
            `<svg class="island-svg" width="160" height="160" viewBox="0 0 140 140"><defs><radialGradient id="island3"><stop offset="0%" style="stop-color:#4ade80"/><stop offset="100%" style="stop-color:#16a34a"/></radialGradient><linearGradient id="windmill"><stop offset="0%" style="stop-color:#ef4444"/><stop offset="100%" style="stop-color:#b91c1c"/></linearGradient></defs><ellipse cx="70" cy="95" rx="53" ry="28" fill="url(#island3)"/><path d="M42,68 Q40,78 42,92" stroke="#15803d" stroke-width="3.5" fill="none"/><ellipse cx="42" cy="65" rx="6" ry="12" fill="${C_RED}"/><path d="M92,70 Q90,80 92,92" stroke="#15803d" stroke-width="3.5" fill="none"/><ellipse cx="92" cy="67" rx="6" ry="12" fill="${C_BLUE}"/><path d="M60,90 L65,55 L75,55 L80,90 Z" fill="url(#windmill)"/><rect x="63" y="85" width="14" height="10" fill="#7f1d1d"/><polygon points="70,55 70,28 50,55" fill="#fefce8"/><polygon points="70,55 90,28 90,55" fill="#fef9c3"/><polygon points="70,55 90,75 70,75" fill="#fefce8"/><polygon points="70,55 50,75 50,55" fill="#fef9c3"/><circle cx="70" cy="55" r="6" fill="#8b5cf6"/>${flowerSVG(35, 85, C_YELLOW)} ${flowerSVG(105, 85, C_RED)} ${flowerSVG(110, 90, C_PURPLE)} ${bushSVG(25, 90, 4, C_GREEN)} ${bushSVG(115, 90, 4, C_GREEN)}<g transform="translate(35, 95)">${sheepSVG}</g><g transform="translate(100, 92)">${sheepSVG}</g><g transform="translate(45, 100)">${sheepSVG}</g><g transform="translate(110, 85)">${sheepSVG}</g><g transform="translate(55, 95)">${personSVG(C_BLUE)}</g> <g transform="translate(85, 95)">${personSVG(C_ORANGE)}</g><text x="70" y="120" text-anchor="middle" font-size="28" font-weight="bold" fill="#fff" stroke="#000" stroke-width="3">3</text></svg>`,
            `<svg class="island-svg" width="150" height="150" viewBox="0 0 150 150"><defs><radialGradient id="island4"><stop offset="0%" style="stop-color:#4ade80"/><stop offset="100%" style="stop-color:#16a34a"/></radialGradient><linearGradient id="palace4"><stop offset="0%" style="stop-color:#fde047"/><stop offset="100%" style="stop-color:#eab308"/></linearGradient></defs><ellipse cx="75" cy="102" rx="58" ry="32" fill="url(#island4)"/><rect x="40" y="55" width="70" height="47" fill="url(#palace4)"/><path d="M40,55 Q75,40 110,55" fill="#facc15"/><circle cx="75" cy="50" r="18" fill="#fef08a"/><rect x="70" y="35" width="10" height="15" fill="${C_RED}"/><polygon points="70,35 75,23 80,35" fill="#ff6b6b"/><rect x="48" y="70" width="12" height="32" fill="${C_BLUE}"/><rect x="90" y="70" width="12" height="32" fill="${C_BLUE}"/><rect x="68" y="75" width="14" height="27" fill="#fbbf24"/>${treeSVG(20, 60, 2.0)} ${treeSVG(130, 60, 2.0)} ${bushSVG(35, 105, 4, C_GREEN)} ${bushSVG(115, 105, 4, C_GREEN)} ${flowerSVG(40, 110, C_PURPLE)} ${flowerSVG(110, 110, C_PURPLE)}<g transform="translate(100, 110)">${rabbitSVG}</g> <g transform="translate(50, 115)">${rabbitSVG}</g><g transform="translate(60, 110)">${personSVG(C_PURPLE)}</g> <g transform="translate(90, 110)">${personSVG(C_RED)}</g><text x="75" y="130" text-anchor="middle" font-size="30" font-weight="bold" fill="#fff" stroke="#000" stroke-width="3">4</text></svg>`,
            `<svg class="island-svg" width="140" height="140" viewBox="0 0 140 140"><defs><radialGradient id="island5"><stop offset="0%" style="stop-color:#4ade80"/><stop offset="100%" style="stop-color:#16a34a"/></radialGradient><linearGradient id="temple5"><stop offset="0%" style="stop-color:#ef4444"/><stop offset="100%" style="stop-color:#991b1b"/></linearGradient></defs><ellipse cx="70" cy="95" rx="54" ry="30" fill="url(#island5)"/><rect x="45" y="60" width="50" height="35" fill="url(#temple5)"/><polygon points="40,60 70,42 100,60" fill="#dc2626"/><polygon points="42,52 70,36 98,52" fill="${C_YELLOW}"/><rect x="60" y="68" width="20" height="27" fill="${C_YELLOW}"/>${treeSVG(25, 90, 0.9)} ${treeSVG(115, 90, 0.9)} ${treeSVG(35, 85, 0.7)} ${treeSVG(105, 85, 0.7)} ${treeSVG(20, 85, 0.7)}${flowerSVG(30, 95, "#fda4af")} ${flowerSVG(110, 95, "#fda4af")} ${bushSVG(50, 95, 3, "#fb7185")} ${bushSVG(90, 95, 3, "#fb7185")}<g transform="translate(55, 100)">${personSVG(C_BLUE)}</g> <g transform="translate(85, 100)">${personSVG(C_PURPLE)}</g> <g transform="translate(100, 100)">${rabbitSVG}</g><text x="70" y="120" text-anchor="middle" font-size="28" font-weight="bold" fill="#fff" stroke="#000" stroke-width="3">5</text></svg>`,
            `<svg class="island-svg" width="140" height="140" viewBox="0 0 140 140"><defs><radialGradient id="island6"><stop offset="0%" style="stop-color:#4ade80"/><stop offset="100%" style="stop-color:#16a34a"/></radialGradient><linearGradient id="tower6"><stop offset="0%" style="stop-color:#a855f7"/><stop offset="100%" style="stop-color:#6b21a8"/></linearGradient></defs><ellipse cx="70" cy="95" rx="52" ry="28" fill="url(#island6)"/><rect x="58" y="40" width="24" height="55" fill="url(#tower6)"/><rect x="56" y="37" width="28" height="6" fill="#581c87"/><polygon points="58,40 70,22 82,40" fill="#9333ea"/><polygon points="60,32 70,18 80,32" fill="#c084fc"/><rect x="64" y="84" width="12" height="11" fill="${C_YELLOW}"/><path d="M50,90 Q52,80 50,70" stroke="#166534" stroke-width="2" fill="none"/><circle cx="50" cy="70" r="3" fill="#4ade80"/><circle cx="90" cy="85" r="3" fill="#c084fc"/><circle cx="95" cy="90" r="3" fill="#e879f9"/><circle cx="30" cy="95" r="4" fill="#15803d"/>${treeSVG(40, 85, 0.8)} ${treeSVG(100, 85, 0.8)} ${treeSVG(30, 88, 0.7)} ${treeSVG(110, 88, 0.7)}${bushSVG(30, 90, 4, "#4ade80")} ${bushSVG(110, 90, 4, "#4ade80")}<g transform="translate(100, 95)">${rabbitSVG}</g> <g transform="translate(40, 95)">${rabbitSVG}</g><g transform="translate(55, 100)">${personSVG(C_ORANGE)}</g> <g transform="translate(85, 100)">${personSVG(C_BLUE)}</g><text x="70" y="120" text-anchor="middle" font-size="28" font-weight="bold" fill="#fff" stroke="#000" stroke-width="3">6</text></svg>`,
            `<svg class="island-svg" width="140" height="140" viewBox="0 0 140 140"><defs><radialGradient id="island7"><stop offset="0%" style="stop-color:#4ade80"/><stop offset="100%" style="stop-color:#16a34a"/></radialGradient><linearGradient id="church7"><stop offset="0%" style="stop-color:#fef3c7"/><stop offset="100%" style="stop-color:#fcd34d"/></linearGradient></defs><ellipse cx="70" cy="93" rx="53" ry="29" fill="url(#island7)"/><rect x="50" y="55" width="40" height="38" fill="url(#church7)"/><polygon points="50,55 70,38 90,55" fill="${C_YELLOW}"/><polygon points="52,48 70,33 88,48" fill="#fbbf24"/><rect x="66" y="35" width="8" height="20" fill="#fbbf24"/><rect x="64" y="68" width="12" height="25" fill="${C_BLUE}"/><circle cx="70" cy="48" r="5" fill="#8b5cf6"/>${treeSVG(25, 85, 0.7)} ${treeSVG(115, 85, 0.7)} ${treeSVG(35, 90, 0.6)} ${treeSVG(105, 90, 0.6)} ${treeSVG(15, 85, 0.6)}${bushSVG(45, 95, 4, C_GREEN)} ${bushSVG(95, 95, 4, C_GREEN)} ${flowerSVG(40, 90, C_RED)} ${flowerSVG(100, 90, C_YELLOW)}<g transform="translate(60, 98)">${personSVG(C_BLUE)}</g> <g transform="translate(80, 98)">${personSVG(C_GREEN)}</g> <g transform="translate(30, 98)">${rabbitSVG}</g><g transform="translate(20, 90)">${sheepSVG}</g><g transform="translate(120, 90)">${sheepSVG}</g><text x="70" y="118" text-anchor="middle" font-size="28" font-weight="bold" fill="#fff" stroke="#000" stroke-width="3">7</text></svg>`,
            `<svg class="island-svg" width="140" height="140" viewBox="0 0 140 140"><defs><radialGradient id="island8"><stop offset="0%" style="stop-color:#4ade80"/><stop offset="100%" style="stop-color:#16a34a"/></radialGradient><linearGradient id="villa8"><stop offset="0%" style="stop-color:#f9a8d4"/><stop offset="100%" style="stop-color:#db2777"/></linearGradient></defs><ellipse cx="70" cy="94" rx="54" ry="30" fill="url(#island8)"/><rect x="42" y="58" width="56" height="36" fill="url(#villa8)"/><polygon points="40,58 70,42 100,58" fill="#be185d"/><polygon points="42,52 70,38 98,52" fill="#f472b6"/><rect x="55" y="70" width="13" height="24" fill="${C_YELLOW}"/><rect x="72" y="70" width="13" height="24" fill="${C_BLUE}"/><rect x="48" y="48" width="10" height="10" fill="${C_RED}"/>${treeSVG(25, 80, 0.8)} ${treeSVG(115, 80, 0.8)} ${treeSVG(15, 82, 0.7)} ${treeSVG(125, 82, 0.7)}${flowerSVG(30, 80, "#e11d48")} ${flowerSVG(35, 85, "#e11d48")} ${flowerSVG(110, 85, "#e11d48")} ${bushSVG(40, 90, 4, "#fbcfe8")} ${bushSVG(100, 90, 4, "#fbcfe8")}<g transform="translate(100, 95)">${rabbitSVG}</g> <g transform="translate(40, 100)">${rabbitSVG}</g><g transform="translate(65, 100)">${personSVG(C_BLUE)}</g> <g transform="translate(85, 100)">${personSVG(C_YELLOW)}</g><text x="70" y="119" text-anchor="middle" font-size="28" font-weight="bold" fill="#fff" stroke="#000" stroke-width="3">8</text></svg>`,
            `<svg class="island-svg" width="140" height="140" viewBox="0 0 140 140"><defs><radialGradient id="island9"><stop offset="0%" style="stop-color:#4ade80"/><stop offset="100%" style="stop-color:#16a34a"/></radialGradient><linearGradient id="fortress9"><stop offset="0%" style="stop-color:#a8a29e"/><stop offset="100%" style="stop-color:#57534e"/></linearGradient></defs><ellipse cx="70" cy="94" rx="55" ry="30" fill="url(#island9)"/><rect x="40" y="50" width="60" height="44" fill="url(#fortress9)"/><rect x="40" y="44" width="10" height="12" fill="#44403c"/><rect x="55" y="44" width="10" height="12" fill="#44403c"/><rect x="75" y="44" width="10" height="12" fill="#44403c"/><rect x="90" y="44" width="10" height="12" fill="#44403c"/><rect x="56" y="66" width="28" height="28" fill="${C_RED}"/><polygon points="56,66 70,52 84,66" fill="#ef4444"/><rect x="65" y="74" width="10" height="20" fill="#78350f"/>${treeSVG(100, 95, 0.8)} ${treeSVG(30, 95, 0.8)} ${treeSVG(110, 90, 0.7)} ${treeSVG(20, 90, 0.7)} ${treeSVG(15, 95, 0.6)}${bushSVG(40, 95, 4, C_GREEN)} ${bushSVG(100, 95, 4, C_GREEN)}<g transform="translate(50, 98)">${personSVG(C_RED)}</g> <g transform="translate(90, 98)">${personSVG(C_RED)}</g> <g transform="translate(110, 100)">${rabbitSVG}</g><text x="70" y="119" text-anchor="middle" font-size="28" font-weight="bold" fill="#fff" stroke="#000" stroke-width="3">9</text></svg>`,
            `<svg class="island-svg" width="220" height="220" viewBox="0 0 200 200"><defs><radialGradient id="island10"><stop offset="0%" style="stop-color:#34d399"/><stop offset="100%" style="stop-color:#059669"/></radialGradient><linearGradient id="royalGold" x1="0" x2="1" y1="0" y2="1"><stop offset="0%" stop-color="#fde047"/><stop offset="50%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#b45309"/></linearGradient><radialGradient id="blueGlow" cx="50%" cy="50%"><stop offset="0%" stop-color="#3b82f6" stop-opacity="0.9"/><stop offset="100%" stop-color="#1e40af" stop-opacity="0"/></radialGradient><filter id="glowGold"><feGaussianBlur stdDeviation="2.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><circle cx="100" cy="100" r="80" fill="url(#blueGlow)" opacity="0.7" class="sparkle"/><ellipse cx="100" cy="140" rx="90" ry="40" fill="url(#island10)"/><path d="M30,130 L40,90 L50,130 Z" fill="#14532d"/><path d="M170,130 L160,90 L150,130 Z" fill="#14532d"/><path d="M50,135 L55,105 L60,135 Z" fill="#15803d"/><path d="M150,135 L145,105 L140,135 Z" fill="#15803d"/>${treeSVG(40, 130, 0.8)} ${treeSVG(160, 130, 0.8)} ${treeSVG(60, 135, 0.6)} ${treeSVG(140, 135, 0.6)} ${bushSVG(50, 150, 6, C_YELLOW)} ${bushSVG(150, 150, 6, C_YELLOW)}<rect x="40" y="80" width="20" height="60" fill="${C_WHITE}" stroke="${C_DARK_BLUE_TOWER}"/><polygon points="35,80 50,60 65,80" fill="${C_RED}"/><rect x="140" y="80" width="20" height="60" fill="${C_WHITE}" stroke="${C_DARK_BLUE_TOWER}"/><polygon points="135,80 150,60 165,80" fill="${C_RED}"/><rect x="70" y="60" width="60" height="80" fill="${C_WHITE}" stroke="${C_DARK_BLUE_TOWER}"/><polygon points="65,60 100,20 135,60" fill="${C_BLUE}"/><rect x="90" y="100" width="20" height="40" fill="#dc2626" stroke="#fff"/><polygon points="90,100 100,90 110,100" fill="#7f1d1d"/><path d="M100,20 L100,-20 L150,0 L100,20 Z" fill="${C_YELLOW}" stroke="#b45309" class="flag"/><circle cx="60" cy="140" r="3" fill="${C_YELLOW}"/><circle cx="80" cy="145" r="3" fill="${C_RED}"/><circle cx="120" cy="145" r="3" fill="${C_YELLOW}"/><circle cx="140" cy="140" r="3" fill="${C_RED}"/><g transform="translate(110, 160)">${rabbitSVG}</g><g transform="translate(80, 160)">${rabbitSVG}</g><g transform="translate(160, 155)">${rabbitSVG}</g><g transform="translate(90, 150)">${personSVG(C_RED)}</g> <g transform="translate(70, 155)">${personSVG(C_BLUE)}</g> <g transform="translate(130, 155)">${personSVG(C_YELLOW)}</g><g transform="translate(50, 150)">${sheepSVG}</g><g transform="translate(150, 150)">${sheepSVG}</g> <text x="100" y="175" text-anchor="middle" font-size="32" font-weight="bold" fill="#fef3c7" stroke="#000" stroke-width="3">10</text></svg>`
        ];

        // --- 3. V·ªä TR√ç ƒê·∫¢O ---
        const islandPositions = [
            { x: 20, y: 35 }, { x: 45, y: 20 }, { x: 75, y: 20 }, { x: 90, y: 40 }, 
            { x: 70, y: 55 }, { x: 40, y: 60 }, { x: 15, y: 70 }, { x: 40, y: 85 }, 
            { x: 70, y: 80 }, { x: 90, y: 85 }   
        ];

        // --- 4. LOGIC GAME ---
        let currentIslandIndex = 0;
        let score = 0;
        let studentName = "";
        let islandStates = new Array(10).fill('locked');
        let isGameSaved = false;

        function createBirdFlocks() {
            const birdsContainer = document.getElementById('birdsContainer');
            for (let flockId = 0; flockId < 3; flockId++) {
                const flock = document.createElement('div');
                flock.className = 'bird-flock';
                const startY = 10 + Math.random() * 30;
                const endY = startY + (Math.random() * 20 - 10);
                const scale = 0.5 + Math.random() * 0.4;
                const duration = 25 + Math.random() * 15;
                const delay = flockId * 8; 

                flock.style.setProperty('--startY', `${startY}vh`);
                flock.style.setProperty('--endY', `${endY}vh`);
                flock.style.setProperty('--scale', scale);
                flock.style.animation = `flyFlock ${duration}s linear infinite`;
                flock.style.animationDelay = `${delay}s`;

                const numBirds = 4 + Math.floor(Math.random() * 3);
                for (let i = 0; i < numBirds; i++) {
                    const bird = document.createElement('div');
                    bird.className = 'bird';
                    bird.style.left = `${i * 30 + Math.random() * 15}px`;
                    bird.style.top = `${(i % 2 === 0 ? -1 : 1) * Math.random() * 20}px`;

                    bird.innerHTML = `
                        <svg width="40" height="20" viewBox="0 0 40 20" style="animation: wingFlapRealistic 0.8s infinite alternate ${Math.random()}s">
                            <path d="M20,12 Q10,0 0,10" fill="none" stroke="#f8fafc" stroke-width="2.5" stroke-linecap="round"/>
                             <path d="M20,12 Q30,0 40,10" fill="none" stroke="#f8fafc" stroke-width="2.5" stroke-linecap="round"/>
                            <circle cx="20" cy="12" r="2.5" fill="#facc15"/>
                        </svg>
                    `;
                    flock.appendChild(bird);
                }
                birdsContainer.appendChild(flock);
            }
        }

        function addSparklesToIsland(islandDiv) {
            const oldStars = islandDiv.querySelectorAll('.star-particle');
            oldStars.forEach(star => star.remove());

            for (let i = 0; i < 15; i++) {
                const star = document.createElement('div');
                star.className = 'star-particle';
                const startX = (Math.random() - 0.5) * 60;
                const startY = (Math.random() - 0.5) * 40;
                const tx = startX * (1 + Math.random());
                const ty = startY - 40 - Math.random() * 40; 
                
                star.style.left = `calc(50% + ${startX}px)`;
                star.style.top = `calc(50% + ${startY}px)`;
                star.style.setProperty('--tx', `${tx}px`);
                star.style.setProperty('--ty', `${ty}px`);
                
                const duration = 2 + Math.random() * 2;
                const delay = Math.random() * 2;
                star.style.animation = `starFloat ${duration}s ease-out infinite ${delay}s`;
                
                islandDiv.appendChild(star);
            }
        }

        function startGame() {
            const nameInput = document.getElementById('studentNameInput').value;
            if (!nameInput.trim()) {
                alert("Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n!");
                return;
            }
            studentName = nameInput;
            document.getElementById('displayStudentName').textContent = studentName;
            
            const loginScreen = document.getElementById('loginScreen');
            loginScreen.style.opacity = '0';
            setTimeout(() => {
                loginScreen.classList.add('hidden');
                const app = document.getElementById('app');
                app.classList.remove('hidden');
                requestAnimationFrame(() => {
                    app.style.opacity = '1';
                    createBirdFlocks();
                });
            }, 500);
            
            islandStates[0] = 'active';
            renderMap();
        }

        function restartGame() {
            currentIslandIndex = 0;
            score = 0;
            isGameSaved = false;
            document.getElementById('scoreDisplay').innerText = score;
            document.getElementById('currentIslandNum').innerText = "1";
            document.getElementById('endGameControls').classList.add('hidden');
            islandStates = new Array(10).fill('locked');
            islandStates[0] = 'active';
            renderMap();
        }

        function renderMap() {
            const map = document.getElementById('islandsMap');
            map.innerHTML = '';
            
            let pathD = `M ${islandPositions[0].x}% ${islandPositions[0].y}%`;
            for(let i=1; i<islandPositions.length; i++) {
                pathD += ` L ${islandPositions[i].x}% ${islandPositions[i].y}%`;
            }
            
            const svgLines = `
            <svg class="absolute inset-0 w-full h-full pointer-events-none overflow-visible">
                <path d="${pathD}" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="4" stroke-dasharray="10,10" />
            </svg>`;
            map.innerHTML += svgLines;

            islandPositions.forEach((pos, index) => {
                let state = islandStates[index];
                if (index === currentIslandIndex && state === 'locked') state = 'active';
                
                let filterClass = "";
                if (state === 'locked') filterClass = "island-locked";
                else if (state === 'active') filterClass = "island-active";
                else if (state === 'correct') filterClass = "island-correct";
                else if (state === 'wrong') filterClass = "island-wrong";

                const islandDiv = document.createElement('div');
                islandDiv.className = `island-container ${filterClass}`;
                islandDiv.style.left = pos.x + '%';
                islandDiv.style.top = pos.y + '%';
                islandDiv.innerHTML = islandDesigns[index];
                
                if (state === 'active' || state === 'correct') {
                    addSparklesToIsland(islandDiv);
                }

                islandDiv.onclick = () => {
                    if (index === currentIslandIndex && state !== 'correct' && state !== 'wrong') {
                        showQuestion(index);
                    }
                };
                
                map.appendChild(islandDiv);
            });
        }

        function showQuestion(index) {
            const q = questions[index];
            document.getElementById('quizNumber').innerText = index + 1;
            document.getElementById('quizQuestion').innerText = q.question;
            
            const ansContainer = document.getElementById('quizAnswers');
            ansContainer.innerHTML = '';
            
            q.answers.forEach((ans, i) => {
                const btn = document.createElement('button');
                btn.className = "quiz-btn w-full p-3 md:p-4 rounded-xl text-left text-sm md:text-lg font-semibold shadow-sm text-blue-900 bg-blue-50 hover:bg-blue-100 border border-blue-200 transition-all";
                btn.innerText = ans;
                btn.onclick = () => handleAnswer(index, i);
                ansContainer.appendChild(btn);
            });

            document.getElementById('quizFeedback').className = "hidden";
            document.getElementById('nextQuestionContainer').classList.add('hidden');
            
            document.getElementById('quizModal').classList.remove('hidden');
            document.getElementById('quizModal').classList.add('flex');
        }

        function handleAnswer(qIndex, ansIndex) {
            const btns = document.getElementById('quizAnswers').querySelectorAll('button');
            btns.forEach(b => b.disabled = true);

            const correctIndex = questions[qIndex].correct;
            const feedback = document.getElementById('quizFeedback');
            feedback.classList.remove('hidden');

            if (ansIndex === correctIndex) {
                playCorrectSound();
                score += 10;
                document.getElementById('scoreDisplay').innerText = score;
                btns[ansIndex].style.backgroundColor = '#22c55e'; // Green
                btns[ansIndex].style.color = 'white';
                const randomPraise = praises[Math.floor(Math.random() * praises.length)];
                feedback.innerText = randomPraise + " (+10 ƒëi·ªÉm)";
                feedback.className = "mt-2 md:mt-4 p-2 md:p-3 rounded text-center font-bold text-sm md:text-lg bg-green-100 text-green-700";
                islandStates[qIndex] = 'correct';
                
                confetti({
                    particleCount: 50,
                    spread: 60,
                    origin: { y: 0.6 }
                });

            } else {
                playWrongSound();
                btns[ansIndex].style.backgroundColor = '#ef4444'; // Red
                btns[ansIndex].style.color = 'white';
                btns[correctIndex].style.backgroundColor = '#22c55e'; 
                btns[correctIndex].style.color = 'white';
                const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                feedback.innerText = "Sai r·ªìi. " + randomEncouragement;
                feedback.className = "mt-2 md:mt-4 p-2 md:p-3 rounded text-center font-bold text-sm md:text-lg bg-red-100 text-red-700";
                islandStates[qIndex] = 'wrong';
            }
            
            document.getElementById('nextQuestionContainer').classList.remove('hidden');
        }

        function nextQuestionAction() {
            document.getElementById('quizModal').classList.add('hidden');
            document.getElementById('quizModal').classList.remove('flex');
            
            currentIslandIndex++;
            if (currentIslandIndex < 10) {
                document.getElementById('currentIslandNum').innerText = currentIslandIndex + 1;
                islandStates[currentIslandIndex] = 'active';
            }
            renderMap();

            if (currentIslandIndex >= 10) {
                endGame();
            }
        }

        // --- H√ÄM L∆ØU ƒêI·ªÇM S·ªê V√ÄO LOCAL STORAGE ---
        function saveScore() {
            const STORAGE_KEY = 'gimp_game_scores';
            const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            history.push({
                name: studentName,
                score: score,
                date: new Date().toISOString()
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
        }

        function endGame() {
            if (!isGameSaved) {
                saveScore();
                isGameSaved = true;
            }

            document.getElementById('endGameControls').classList.remove('hidden');
            
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            var interval = setInterval(function() {
              var timeLeft = animationEnd - Date.now();

              if (timeLeft <= 0) {
                return clearInterval(interval);
              }

              var particleCount = 50 * (timeLeft / duration);
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random() * 0.2 + 0.1, y: Math.random() - 0.2 } }));
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random() * 0.2 + 0.7, y: Math.random() - 0.2 } }));
            }, 250);
        }

        // --- LOGIC B·∫¢NG X·∫æP H·∫†NG (C√ì L·ªäCH S·ª¨) ---
        function getLeaderboardData() {
            const realData = JSON.parse(localStorage.getItem('gimp_game_scores') || '[]');
            
            const fakeNames = ["Minh Anh", "Gia Huy", "B·∫£o Ng·ªçc", "Tu·∫•n Ki·ªát", "Th·∫£o Ly", "ƒê·ª©c Minh", "H·∫£i ƒêƒÉng", "Qu·ª≥nh Anh"];
            const fakeData = fakeNames.map(n => ({ 
                name: n, 
                score: Math.floor(Math.random() * 5) * 10 + 60,
                isFake: true 
            }));
            
            let allData = [...realData, ...fakeData];
            allData.sort((a, b) => b.score - a.score);
            return allData;
        }

        function showLeaderboard() {
            const data = getLeaderboardData();
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';
            
            data.forEach((player, index) => {
                const tr = document.createElement('tr');
                const isCurrentUser = (player.name === studentName && !player.isFake);
                tr.className = `rank-row border-b hover:bg-gray-50 transition ${isCurrentUser ? 'user-row bg-blue-100 border-blue-300' : ''}`;
                
                let rankDisplay = index + 1;
                if(index === 0) rankDisplay = "ü•á " + rankDisplay;
                else if(index === 1) rankDisplay = "ü•à " + rankDisplay;
                else if(index === 2) rankDisplay = "ü•â " + rankDisplay;

                tr.innerHTML = `
                    <td class="p-2 md:p-3 text-center">${rankDisplay}</td>
                    <td class="p-2 md:p-3 font-medium ${isCurrentUser ? 'text-blue-800 font-bold' : ''}">${player.name} ${isCurrentUser ? '(B·∫°n)' : ''}</td>
                    <td class="p-2 md:p-3 text-right font-mono text-base md:text-lg font-bold ${isCurrentUser ? 'text-blue-800' : ''}">${player.score}</td>
                `;
                tbody.appendChild(tr);
            });

            const modal = document.getElementById('leaderboardModalWrapper');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeLeaderboard() {
            const modal = document.getElementById('leaderboardModalWrapper');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
  </script>
</body>
</html>


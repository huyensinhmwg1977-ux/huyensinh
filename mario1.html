<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H√†nh Tr√¨nh Tri Th·ª©c - B·∫£ng X·∫øp H·∫°ng</title>
    <style>
        /* --- C·∫§U H√åNH CHUNG --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(#2980b9, #6dd5fa);
            margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; user-select: none;
        }

        /* --- PH√ÅO HOA --- */
        .particle { position: absolute; width: 10px; height: 10px; border-radius: 50%; pointer-events: none; z-index: 9999; animation: explode 0.8s ease-out forwards; box-shadow: 0 0 10px currentColor; }
        @keyframes explode { 0% { transform: translate(0, 0) scale(1.5); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; } }

        /* --- THANH TR·∫†NG TH√ÅI ONLINE --- */
        .online-status {
            position: absolute; top: 15px; right: 20px;
            background: rgba(0,0,0,0.5); color: #2ecc71;
            padding: 8px 15px; border-radius: 20px;
            font-weight: bold; font-size: 1.1em;
            display: flex; align-items: center; gap: 10px;
            z-index: 50; border: 1px solid #2ecc71;
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }
        .dot { height: 10px; width: 10px; background-color: #2ecc71; border-radius: 50%; display: inline-block; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* --- LOGIN --- */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 999; display: flex; justify-content: center; align-items: center; }
        .login-card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 0 50px rgba(243, 156, 18, 0.5); text-align: center; width: 450px; border: 6px solid #f39c12; animation: popIn 0.5s; }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .input-name { width: 100%; padding: 15px; margin-bottom: 25px; border: 3px solid #ddd; border-radius: 12px; font-size: 1.2em; outline: none; text-align: center; }
        .btn-start { background: #2ecc71; color: white; border: none; padding: 15px 40px; font-size: 1.4em; border-radius: 50px; cursor: pointer; font-weight: bold; width: 100%; box-shadow: 0 6px 0 #27ae60; transition: 0.2s; }
        .btn-start:hover { transform: translateY(-4px); }

        /* --- S√ÇN KH·∫§U --- */
        #game-wrapper { display: none; height: 100%; flex-direction: column; }
        .stage-area { position: relative; flex: 1; width: 100%; background-image: url('https://i.imgur.com/P8d5s0H.png'); background-size: cover; background-position: center bottom; border-bottom: 25px solid #5d4037; }
        .grass { position: absolute; bottom: 0; width: 100%; height: 55px; background: repeating-linear-gradient(45deg, #7cb342 0px, #7cb342 20px, #558b2f 20px, #558b2f 40px); z-index: 2; border-top: 6px solid #33691e; }
        
        #character { position: absolute; bottom: 50px; left: 5%; font-size: 90px; z-index: 15; filter: drop-shadow(5px 10px 5px rgba(0,0,0,0.4)); transform: scaleX(-1); transform-origin: bottom center; transition: left 1.0s cubic-bezier(0.25, 0.1, 0.25, 1); }
        .running { animation: run-bob-smooth 0.7s infinite cubic-bezier(0.4, 0, 0.2, 1) alternate; }
        @keyframes run-bob-smooth { 0% { transform: scaleX(-1) translateY(0) rotate(2deg) scaleY(0.98); } 100% { transform: scaleX(-1) translateY(-12px) rotate(-3deg) scaleY(1.02); } }
        .jump-anim-smooth { animation: jump-squash-stretch 1.0s linear !important; }
        @keyframes jump-squash-stretch { 0% { transform: scaleX(-1) scale(1, 1) translateY(0); } 15% { transform: scaleX(-1) scale(1.2, 0.8) translateY(10px); } 40% { transform: scaleX(-1) scale(0.9, 1.15) translateY(-200px) rotate(-5deg); } 75% { transform: scaleX(-1) scale(1.2, 0.8) translateY(15px); } 100% { transform: scaleX(-1) scale(1, 1) translateY(0); } }
        .wrong-anim { animation: shake-hard 0.5s !important; }
        @keyframes shake-hard { 0% { transform: scaleX(-1) translateX(0); } 25% { transform: scaleX(-1) translateX(-15px) rotate(5deg); } 75% { transform: scaleX(-1) translateX(15px) rotate(-5deg); } 100% { transform: scaleX(-1) translateX(0); } }

        #castle { position: absolute; bottom: 50px; right: 1%; font-size: 130px; z-index: 5; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.3)); }
        .milestone { position: absolute; bottom: 65px; font-size: 45px; z-index: 4; filter: drop-shadow(2px 4px 2px rgba(0,0,0,0.3)); opacity: 0.8; animation: float-milestone 2.5s ease-in-out infinite alternate; }
        @keyframes float-milestone { from { transform: translateY(0); } to { transform: translateY(-10px); } }
        .cloud { position: absolute; color: rgba(255,255,255,0.85); animation: float linear infinite; text-shadow: 0 0 25px rgba(255,255,255,0.9); }
        @keyframes float { from { transform: translateX(100vw); } to { transform: translateX(-250px); } }

        /* --- C√ÇU H·ªéI --- */
        .quiz-area { height: 45%; background-color: #34495e; background-image: radial-gradient(#34495e, #2c3e50); color: white; padding: 10px 20px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; box-shadow: 0 -10px 30px rgba(0,0,0,0.5); position: relative; border-top: 8px solid #f39c12; overflow-y: auto; }
        .quiz-area::-webkit-scrollbar { width: 8px; } .quiz-area::-webkit-scrollbar-thumb { background: #f39c12; border-radius: 4px;}
        .stats { position: absolute; top: 10px; left: 20px; font-size: 1.2em; color: #fff; font-weight: 900; background: linear-gradient(to right, #f39c12, #d35400); padding: 5px 20px; border-radius: 30px; box-shadow: 3px 5px 0 #8e44ad; border: 2px solid #fff; z-index: 20; }
        .question-text { font-size: 1.3em; margin: 40px 0 15px 0; text-align: center; width: 90%; max-width: 900px; background: #fff; color: #2c3e50; padding: 15px 25px; border-radius: 15px; border: 4px solid #2980b9; box-shadow: 0 6px 0 #1a5276; font-weight: 700; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 900px; }
        .btn { background-color: #ecf0f1; color: #34495e; border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: all 0.1s; box-shadow: 0 5px 0 #95a5a6; position: relative; top: 0; border: 2px solid #bdc3c7; }
        .btn:hover:not(:disabled) { top: -3px; background-color: #f1c40f; color: #d35400; border-color: #d35400; }
        .next-btn { display: none; margin-top: 20px; padding: 12px 40px; background-color: #e67e22; color: white; font-size: 1.3em; font-weight: bold; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 6px 0 #d35400; animation: pulse 1.5s infinite; text-transform: uppercase; margin-bottom: 20px; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(230,126,34,0.7); } 70% { box-shadow: 0 0 0 15px rgba(230,126,34,0); } }

        /* --- K·∫æT TH√öC V√Ä B·∫¢NG X·∫æP H·∫†NG --- */
        #end-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 10, 15, 0.98); color: white; z-index: 10000; text-align: center; flex-direction: column; justify-content: flex-start; align-items: center; padding-top: 40px; overflow-y: auto; }
        
        .result-container { display: flex; gap: 40px; align-items: flex-start; flex-wrap: wrap; justify-content: center; width: 90%; }
        
        .score-panel { flex: 1; min-width: 300px; max-width: 400px; }
        .leaderboard-panel { flex: 1; min-width: 350px; max-width: 500px; background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; border: 2px solid #f39c12; }
        
        .score-box { background: rgba(255,255,255,0.15); padding: 15px; border-radius: 20px; border: 3px solid #fff; margin-bottom: 30px; }
        
        .btn-group { display: flex; gap: 20px; justify-content: center; }
        .btn-end { padding: 15px 30px; font-size: 18px; color: white; border: 3px solid white; border-radius: 30px; cursor: pointer; font-weight: 900; text-transform: uppercase; box-shadow: 0 5px 15px rgba(0,0,0,0.5); transition: all 0.2s; }
        .btn-end:hover { transform: scale(1.1); }
        .btn-replay { background: linear-gradient(#2ecc71, #27ae60); }
        .btn-exit { background: linear-gradient(#e74c3c, #c0392b); }

        /* B·∫£ng x·∫øp h·∫°ng Table */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; color: white; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2); }
        th { background: rgba(243, 156, 18, 0.8); color: black; font-weight: bold; text-transform: uppercase; }
        .rank-1 { color: #f1c40f; font-weight: bold; font-size: 1.2em; text-shadow: 0 0 10px gold; }
        .rank-2 { color: #bdc3c7; font-weight: bold; }
        .rank-3 { color: #d35400; font-weight: bold; }
        .current-player-row { background: rgba(46, 204, 113, 0.3); }

        code { background: #eee; padding: 3px 6px; border-radius: 4px; color: #c0392b; font-family: Consolas, monospace; border: 1px solid #ccc; font-size: 0.9em; }
    </style>
</head>
<body>

    <div class="online-status">
        <span class="dot"></span>
        <span>ƒêang ch∆°i: <span id="online-count">12</span></span>
    </div>

    <div id="login-screen">
        <div class="login-card">
            <div style="font-size: 70px; margin-bottom: 10px;">üéí</div>
            <h2 style="color: #d35400;">H√ÄNH TR√åNH TRI TH·ª®C</h2>
            <input type="text" id="player-name-input" class="input-name" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." autocomplete="off">
            <button class="btn-start" onclick="enterGame()">B·∫ÆT ƒê·∫¶U CH∆†I ‚ñ∂</button>
        </div>
    </div>

    <div id="game-wrapper">
        <div class="stage-area">
            <div class="cloud" style="top: 15%; font-size: 90px; animation-duration: 40s;">‚òÅÔ∏è</div>
            <div class="cloud" style="top: 5%; font-size: 70px; animation-duration: 28s; left: 30%;">‚òÅÔ∏è</div>
            
            <div class="milestone" style="left: 13%;">üçÑ</div>
            <div class="milestone" style="left: 21%;">ü•ö</div>
            <div class="milestone" style="left: 29%;">üê§</div>
            <div class="milestone" style="left: 37%;">üçî</div>
            <div class="milestone" style="left: 45%;">üö≤</div>
            <div class="milestone" style="left: 53%;">üéÆ</div>
            <div class="milestone" style="left: 61%;">üé∏</div>
            <div class="milestone" style="left: 69%;">üõ∏</div>
            <div class="milestone" style="left: 77%;">üíé</div>
            <div class="milestone" style="left: 85%; font-size: 55px;">üóùÔ∏è</div>

            <div id="character" class="running">üèÉ</div> 
            
            <div id="castle">üè∞</div>
            <div class="grass"></div>
        </div>

        <div class="quiz-area">
            <div class="stats">üë§ <span id="display-name">B·∫°n Nh·ªè</span> | ‚≠ê ƒêI·ªÇM: <span id="score">0</span></div>
            <div class="question-text" id="question-text">S·∫µn s√†ng ch∆∞a?</div>
            <div class="options-grid" id="options-area"></div>
            <button id="next-btn" class="next-btn" onclick="handleNextQuestion()">C√ÇU TI·∫æP THEO ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="end-screen">
        <h1 style="color: #f1c40f; font-size: 3em; margin: 10px 0; text-shadow: 0 5px 15px black;">HO√ÄN TH√ÄNH!</h1>
        
        <div class="result-container">
            <div class="score-panel">
                <h3 id="end-name" style="color: white; font-size: 2em; margin: 10px 0;"></h3>
                <div class="score-box">
                    <p style="font-size: 1.2em; margin: 0; color: #ddd;">T·ªïng ƒëi·ªÉm:</p>
                    <h2 style="font-size: 5em; margin: 0; color: #2ecc71; text-shadow: 3px 3px 0 #000;" id="final-score">0</h2>
                </div>
                <div class="btn-group">
                    <button class="btn-end btn-replay" onclick="replayGame()">üîÑ L√ÄM L·∫†I</button>
                    <button class="btn-end btn-exit" onclick="exitGame()">üö™ THO√ÅT</button>
                </div>
            </div>

            <div class="leaderboard-panel">
                <h3 style="color: #f39c12; margin-top: 0; border-bottom: 1px solid #fff; padding-bottom: 10px;">üèÜ B·∫¢NG X·∫æP H·∫†NG (Top 5)</h3>
                <table id="leaderboard-table">
                    <thead>
                        <tr>
                            <th>H·∫°ng</th>
                            <th>T√™n</th>
                            <th>ƒêi·ªÉm</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // --- GI·∫¢ L·∫¨P S·ªê NG∆Ø·ªúI CH∆†I ---
        function updateOnlineCount() {
            const countEl = document.getElementById('online-count');
            // S·ªë ng∆∞·ªùi ng·∫´u nhi√™n t·ª´ 15 ƒë·∫øn 35
            let count = Math.floor(Math.random() * (35 - 15 + 1) + 15);
            countEl.innerText = count;
        }
        setInterval(updateOnlineCount, 3000); // C·∫≠p nh·∫≠t m·ªói 3 gi√¢y
        updateOnlineCount();

        // --- PH√ÅO HOA ---
        function createFireworks(x, y) {
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                document.body.appendChild(particle);
                const colors = ['#e74c3c', '#f1c40f', '#2ecc71', '#3498db', '#e67e22', '#ffffff'];
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                particle.style.left = x + 'px'; particle.style.top = y + 'px';
                const angle = Math.random() * Math.PI * 2;
                const velocity = 150 + Math.random() * 200;
                particle.style.setProperty('--tx', `${Math.cos(angle) * velocity}px`);
                particle.style.setProperty('--ty', `${Math.sin(angle) * velocity}px`);
                setTimeout(() => particle.remove(), 800);
            }
        }

        function playSound(type) {
            if (audioCtx.state === 'suspended') { audioCtx.resume(); }
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            } else {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        const questions = [
            { q: "C√¢u 1: Trong Python, l·ªánh n√†o d√πng ƒë·ªÉ th√™m ph·∫ßn t·ª≠ v√†o CU·ªêI danh s√°ch?", a: [ { t: "list.add(x)", c: false }, { t: "list.append(x)", c: true }, { t: "list.insert(x)", c: false }, { t: "list.input(x)", c: false } ] },
            { q: "C√¢u 2: ƒê·ªÉ x√≥a T·∫§T C·∫¢ c√°c ph·∫ßn t·ª≠ trong danh s√°ch A, ta d√πng l·ªánh n√†o?", a: [ { t: "A.clear()", c: true }, { t: "A.remove_all()", c: false }, { t: "A.delete()", c: false }, { t: "A.clean()", c: false } ] },
            { q: "C√¢u 3: C√∫ ph√°p ch√®n ph·∫ßn t·ª≠ x v√†o v·ªã tr√≠ k trong danh s√°ch A l√†:", a: [ { t: "A.insert(x, k)", c: false }, { t: "A.add(k, x)", c: false }, { t: "A.append(k, x)", c: false }, { t: "A.insert(k, x)", c: true } ] },
            { q: "C√¢u 4: To√°n t·ª≠ <code>in</code> trong danh s√°ch d√πng ƒë·ªÉ l√†m g√¨?", a: [ { t: "Ki·ªÉm tra ph·∫ßn t·ª≠ c√≥ trong danh s√°ch kh√¥ng", c: true }, { t: "Th√™m ph·∫ßn t·ª≠ v√†o danh s√°ch", c: false }, { t: "Duy·ªát qua c√°c ph·∫ßn t·ª≠", c: false }, { t: "X√≥a ph·∫ßn t·ª≠ kh·ªèi danh s√°ch", c: false } ] },
            { q: "C√¢u 5: L·ªánh <code>remove()</code> trong Python c√≥ t√°c d·ª•ng g√¨?", a: [ { t: "X√≥a ph·∫ßn t·ª≠ t·∫°i v·ªã tr√≠ index", c: false }, { t: "X√≥a ph·∫ßn t·ª≠ cu·ªëi c√πng", c: false }, { t: "X√≥a ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n t√¨m th·∫•y c√≥ gi√° tr·ªã c·ª• th·ªÉ", c: true }, { t: "X√≥a to√†n b·ªô danh s√°ch", c: false } ] },
            { q: "C√¢u 6: Cho <code>A = [1, 5, 1, 0, 2]</code>. Sau l·ªánh <code>A.remove(1)</code>, A l√†:", a: [ { t: "[5, 1, 0, 2]", c: true }, { t: "[5, 0, 2]", c: false }, { t: "[1, 5, 0, 2]", c: false }, { t: "[1, 5, 1, 0]", c: false } ] },
            { q: "C√¢u 7: Cho <code>ds = [2, 4, 6]</code>. K·∫øt qu·∫£ <code>ds.insert(1, 10)</code> l√†:", a: [ { t: "[2, 4, 6, 10]", c: false }, { t: "[2, 10, 4, 6]", c: true }, { t: "[10, 2, 4, 6]", c: false }, { t: "[2, 4, 10, 6]", c: false } ] },
            { q: "C√¢u 8: ƒêo·∫°n code sau tr·∫£ v·ªÅ g√¨?<br><code>A=[10,20,30,40]</code><br><code>if 20 in A: A.remove(20)</code><br><code>print(len(A))</code>", a: [ { t: "4", c: false }, { t: "3", c: true }, { t: "20", c: false }, { t: "B√°o l·ªói", c: false } ] },
            { q: "C√¢u 9: Cho <code>A=[]</code>. Sau l·ªánh: <code>append(5)</code>, <code>append(10)</code>, <code>clear()</code>. Gi√° tr·ªã A l√†:", a: [ { t: "[5, 10]", c: false }, { t: "[10]", c: false }, { t: "[] (R·ªóng)", c: true }, { t: "None", c: false } ] },
            { q: "C√¢u 10: <code>hs=['Lan','Mai','C√∫c']</code>. Thay 'Mai' b·∫±ng 'ƒê√†o' d√πng l·ªánh n√†o?", a: [ { t: "hs.replace('Mai', 'ƒê√†o')", c: false }, { t: "hs[2] = 'ƒê√†o'", c: false }, { t: "hs[1] = 'ƒê√†o'", c: true }, { t: "hs.insert(1, 'ƒê√†o')", c: false } ] }
        ];

        let currentIdx = 0; let score = 0; let playerName = ""; let currentPos = 5;
        const char = document.getElementById('character'); const qText = document.getElementById('question-text');
        const optArea = document.getElementById('options-area'); const scoreDisplay = document.getElementById('score');
        const nextBtn = document.getElementById('next-btn');

        function enterGame() {
            const inputName = document.getElementById('player-name-input').value;
            if (inputName.trim() === "") { alert("B·∫°n ∆°i, h√£y nh·∫≠p t√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu nh√©!"); return; }
            playerName = inputName;
            document.getElementById('display-name').innerText = playerName;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-wrapper').style.display = 'flex';
            if (audioCtx.state === 'suspended') { audioCtx.resume(); }
            loadQuestion();
        }

        function loadQuestion() {
            optArea.innerHTML = ""; nextBtn.style.display = "none";
            if (currentIdx >= questions.length) { finishGame(); return; }
            const data = questions[currentIdx];
            qText.innerHTML = data.q;
            data.a.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn'; btn.innerHTML = opt.t;
                btn.onclick = (e) => checkAnswer(opt.c, btn, data.a, e);
                optArea.appendChild(btn);
            });
        }

        function checkAnswer(isCorrect, btnClicked, allOptions, event) {
            const allBtns = optArea.querySelectorAll('.btn');
            allBtns.forEach(b => b.disabled = true);
            if (isCorrect) {
                playSound('correct'); createFireworks(event.clientX, event.clientY);
                btnClicked.style.backgroundColor = "#2ecc71"; btnClicked.style.color = "white";
                score += 10; scoreDisplay.innerText = score;
                char.classList.remove('running'); char.classList.add('jump-anim-smooth');
                setTimeout(() => { char.classList.remove('jump-anim-smooth'); char.classList.add('running'); }, 1000);
                currentPos += 8.3; char.style.left = currentPos + "%";
            } else {
                playSound('wrong');
                btnClicked.style.backgroundColor = "#e74c3c"; btnClicked.style.color = "white";
                char.classList.remove('running'); char.classList.add('wrong-anim'); char.innerText = "üòµ"; 
                setTimeout(() => { char.classList.remove('wrong-anim'); char.classList.add('running'); char.innerText = "üèÉ"; }, 500);
                allBtns.forEach((b, index) => { if (allOptions[index].c) { b.style.backgroundColor = "#2ecc71"; b.style.color = "white"; } });
            }
            nextBtn.style.display = "block";
            if (currentIdx === questions.length - 1) { nextBtn.innerText = "XEM K·∫æT QU·∫¢ üèÅ"; } else { nextBtn.innerText = "C√ÇU TI·∫æP THEO ‚û°Ô∏è"; }
        }

        function handleNextQuestion() { currentIdx++; loadQuestion(); }

        // --- QU·∫¢N L√ù B·∫¢NG X·∫æP H·∫†NG (Local Storage) ---
        function saveScore(name, score) {
            let leaderboard = JSON.parse(localStorage.getItem('marioGameLeaderboard')) || [];
            leaderboard.push({ name: name, score: score });
            // S·∫Øp x·∫øp gi·∫£m d·∫ßn theo ƒëi·ªÉm
            leaderboard.sort((a, b) => b.score - a.score);
            // Ch·ªâ gi·ªØ l·∫°i Top 10
            if (leaderboard.length > 10) leaderboard = leaderboard.slice(0, 10);
            localStorage.setItem('marioGameLeaderboard', JSON.stringify(leaderboard));
            return leaderboard;
        }

        function displayLeaderboard(leaderboard) {
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = ""; // X√≥a c≈©
            
            leaderboard.forEach((entry, index) => {
                const tr = document.createElement('tr');
                // Highlight t√™n ng∆∞·ªùi ƒëang ch∆°i
                if (entry.name === playerName && entry.score === score) {
                    tr.classList.add('current-player-row');
                }
                
                let rankDisplay = index + 1;
                let rankClass = "";
                if (index === 0) { rankDisplay = "ü•á"; rankClass = "rank-1"; }
                else if (index === 1) { rankDisplay = "ü•à"; rankClass = "rank-2"; }
                else if (index === 2) { rankDisplay = "ü•â"; rankClass = "rank-3"; }

                tr.innerHTML = `
                    <td class="${rankClass}">${rankDisplay}</td>
                    <td>${entry.name}</td>
                    <td style="font-weight: bold;">${entry.score}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function finishGame() {
            document.getElementById('end-screen').style.display = 'flex';
            document.getElementById('final-score').innerText = score;
            document.getElementById('end-name').innerText = "Ch√∫c m·ª´ng " + playerName + "!";
            
            if(score >= 80) { char.style.left = "88%"; char.innerText = "ü§¥"; char.style.fontSize = "110px"; char.style.zIndex = "20"; char.classList.add('jump-anim-smooth'); }
            
            // L∆ØU ƒêI·ªÇM V√Ä HI·ªÜN B·∫¢NG X·∫æP H·∫†NG
            const updatedLeaderboard = saveScore(playerName, score);
            displayLeaderboard(updatedLeaderboard);
        }

        function replayGame() {
            score = 0; currentIdx = 0; currentPos = 5; scoreDisplay.innerText = 0;
            char.style.left = "5%"; char.innerText = "üèÉ"; char.style.fontSize = "90px"; char.style.zIndex = "15";
            char.classList.remove('jump-anim-smooth', 'correct-anim'); char.classList.add('running');
            document.getElementById('end-screen').style.display = 'none';
            loadQuestion();
        }

        function exitGame() { location.reload(); }
    </script>
</body>
</html>
